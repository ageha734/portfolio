#!/usr/bin/env bun
// @bun
var Vt=Object.create;var{getPrototypeOf:Lt,defineProperty:U,getOwnPropertyNames:Qt}=Object;var Yt=Object.prototype.hasOwnProperty;var j=(t,e,n)=>{n=t!=null?Vt(Lt(t)):{};let s=e||!t||!t.__esModule?U(n,"default",{value:t,enumerable:!0}):n;for(let o of Qt(t))if(!Yt.call(s,o))U(s,o,{get:()=>t[o],enumerable:!0});return s};var Wt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var nt=(t,e)=>{for(var n in e)U(t,n,{get:e[n],enumerable:!0,configurable:!0,set:(s)=>e[n]=()=>s})};var $=(t,e)=>()=>(t&&(e=t(t=0)),e);var I=Wt((vn,L)=>{var q=process||{},ut=q.argv||[],M=q.env||{},se=!(!!M.NO_COLOR||ut.includes("--no-color"))&&(!!M.FORCE_COLOR||ut.includes("--color")||q.platform==="win32"||(q.stdout||{}).isTTY&&M.TERM!=="dumb"||!!M.CI),oe=(t,e,n=t)=>(s)=>{let o=""+s,r=o.indexOf(e,t.length);return~r?t+re(o,e,n,r)+e:t+o+e},re=(t,e,n,s)=>{let o="",r=0;do o+=t.substring(r,s)+n,r=s+e.length,s=t.indexOf(e,r);while(~s);return o+t.substring(r)},mt=(t=se)=>{let e=t?oe:()=>String;return{isColorSupported:t,reset:e("\x1B[0m","\x1B[0m"),bold:e("\x1B[1m","\x1B[22m","\x1B[22m\x1B[1m"),dim:e("\x1B[2m","\x1B[22m","\x1B[22m\x1B[2m"),italic:e("\x1B[3m","\x1B[23m"),underline:e("\x1B[4m","\x1B[24m"),inverse:e("\x1B[7m","\x1B[27m"),hidden:e("\x1B[8m","\x1B[28m"),strikethrough:e("\x1B[9m","\x1B[29m"),black:e("\x1B[30m","\x1B[39m"),red:e("\x1B[31m","\x1B[39m"),green:e("\x1B[32m","\x1B[39m"),yellow:e("\x1B[33m","\x1B[39m"),blue:e("\x1B[34m","\x1B[39m"),magenta:e("\x1B[35m","\x1B[39m"),cyan:e("\x1B[36m","\x1B[39m"),white:e("\x1B[37m","\x1B[39m"),gray:e("\x1B[90m","\x1B[39m"),bgBlack:e("\x1B[40m","\x1B[49m"),bgRed:e("\x1B[41m","\x1B[49m"),bgGreen:e("\x1B[42m","\x1B[49m"),bgYellow:e("\x1B[43m","\x1B[49m"),bgBlue:e("\x1B[44m","\x1B[49m"),bgMagenta:e("\x1B[45m","\x1B[49m"),bgCyan:e("\x1B[46m","\x1B[49m"),bgWhite:e("\x1B[47m","\x1B[49m"),blackBright:e("\x1B[90m","\x1B[39m"),redBright:e("\x1B[91m","\x1B[39m"),greenBright:e("\x1B[92m","\x1B[39m"),yellowBright:e("\x1B[93m","\x1B[39m"),blueBright:e("\x1B[94m","\x1B[39m"),magentaBright:e("\x1B[95m","\x1B[39m"),cyanBright:e("\x1B[96m","\x1B[39m"),whiteBright:e("\x1B[97m","\x1B[39m"),bgBlackBright:e("\x1B[100m","\x1B[49m"),bgRedBright:e("\x1B[101m","\x1B[49m"),bgGreenBright:e("\x1B[102m","\x1B[49m"),bgYellowBright:e("\x1B[103m","\x1B[49m"),bgBlueBright:e("\x1B[104m","\x1B[49m"),bgMagentaBright:e("\x1B[105m","\x1B[49m"),bgCyanBright:e("\x1B[106m","\x1B[49m"),bgWhiteBright:e("\x1B[107m","\x1B[49m")}};L.exports=mt();L.exports.createColors=mt});var ht={};nt(ht,{setupEnvFile:()=>Q,logSubStep:()=>c,logStep:()=>m,logSection:()=>v,LoadingBar:()=>d});import{copyFileSync as ie,existsSync as pt,writeFileSync as le}from"fs";import{join as ft}from"path";function v(t){console.log(),console.log(S.default.bold(S.default.cyan(`  ${t}`))),console.log(S.default.dim(`  ${"\u2500".repeat(50)}`))}function m(t,e,n="info"){let s={info:S.default.blue,success:S.default.green,warning:S.default.yellow,error:S.default.red},o;if(n==="success")o="\u2713";else if(n==="error")o="\u2717";else if(n==="warning")o="\u26A0";else o="\u2192";console.log(`  ${s[n](o)} ${t} ${e}`)}function c(t,e="info"){let n={info:S.default.dim,success:S.default.green,warning:S.default.yellow},s;if(e==="success")s="\u2713";else if(e==="warning")s="\u26A0";else s="  ";console.log(`    ${n[e](s)} ${t}`)}class d{message;interval=null;frames=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"];frameIndex=0;isActive=!1;constructor(t){this.message=t}start(){if(this.isActive)return;this.isActive=!0,this.frameIndex=0,this.interval=setInterval(()=>{let t=this.frames[this.frameIndex%this.frames.length];process.stdout.write(`\r    ${S.default.cyan(t)} ${S.default.dim(this.message)}`),this.frameIndex++},100)}stop(t=!0,e){if(!this.isActive)return;if(this.isActive=!1,this.interval)clearInterval(this.interval),this.interval=null;if(process.stdout.write(`\r${" ".repeat(80)}\r`),e)c(e,t?"success":"warning")}}async function Q(t){v("\uD83D\uDCDD \u74B0\u5883\u8A2D\u5B9A");let e=ft(t,".env.example"),n=ft(t,".env");if(pt(n)){m("",".env\u30D5\u30A1\u30A4\u30EB\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");return}if(pt(e))m("\uD83D\uDCDD",".env.example\u304B\u3089.env\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u3066\u3044\u307E\u3059...","info"),ie(e,n),m("",".env\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u307E\u3057\u305F","success");else m("\u26A0\uFE0F",".env.example\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002\u7A7A\u306E.env\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u307E\u3059...","warning"),le(n,`# Environment variables
`),m("","\u7A7A\u306E.env\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u307E\u3057\u305F","success")}var S;var y=$(()=>{S=j(I(),1)});var{$:b}=globalThis.Bun;import{existsSync as z}from"fs";import{join as O}from"path";async function dt(){try{return await b`docker --version`.quiet(),!0}catch{return!1}}async function gt(t){try{return(await b`docker ps -a --filter name=^${t}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===t}catch{return!1}}async function bt(t){try{return(await b`docker ps --filter name=^${t}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===t}catch{return!1}}async function K(t){try{return(await b`docker images --format {{.Repository}}:{{.Tag}}`.quiet()).stdout.toString().trim().split(`
`).some((s)=>s.startsWith(`${t}:`)||s===t)}catch{return!1}}async function ae(t,e,n){let s=new d("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059");s.start();try{await b`docker build -t db -f ${e} ${n}`.cwd(t).quiet(),s.stop(!0,"MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(o){throw s.stop(!1,"MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),o}}async function ce(t,e,n){c("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059...","info");try{await b`docker build -t db -f ${e} ${n}`.cwd(t).quiet(),c("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(s){throw c("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),s}}async function ue(t,e){let n=new d("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059");n.start();try{await b`docker build -t e2e -f ${e} .`.cwd(t).quiet(),n.stop(!0,"E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(s){throw n.stop(!1,"E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),s}}async function me(t,e){c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059...","info");try{await b`docker build -t e2e -f ${e} .`.cwd(t).quiet(),c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(n){throw c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),n}}async function pe(t,e,n){let s=new d("Redis Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059");s.start();try{await b`docker build -t cache -f ${e} ${n}`.cwd(t).quiet(),s.stop(!0,"Redis Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(o){throw s.stop(!1,"Redis Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),o}}async function fe(t,e,n){c("Redis Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059...","info");try{await b`docker build -t cache -f ${e} ${n}`.cwd(t).quiet(),c("Redis Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(s){throw c("Redis Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),s}}async function he(t,e){try{return(await b`docker exec -e MYSQL_PWD=${e} ${t} mysqladmin ping -h localhost -u root`.quiet()).exitCode===0}catch{return!1}}async function de(t,e){try{return(await b`docker exec ${t} redis-cli -a ${e} ping`.quiet()).stdout.toString().trim()==="PONG"}catch{return!1}}function E(t,e,n){if(t)t.stop(e,n);else c(n,e?"success":"warning")}async function ge(t,e,n){for(let s=0;s<n;s++){if(await he(t,e))return!0;await new Promise((r)=>setTimeout(r,1000))}return!1}async function Y(t,e=!0,n=30){let s=process.env.MYSQL_ROOT_PASSWORD||"rootpassword",o=e?new d("MySQL\u306E\u8D77\u52D5\u3092\u5F85\u6A5F\u3057\u3066\u3044\u307E\u3059"):null;if(o)o.start();try{if(await ge(t,s,n))return E(o,!0,"MySQL\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F"),!0;return E(o,!1,"MySQL\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F"),!1}catch{return E(o,!1,"MySQL\u306E\u8D77\u52D5\u78BA\u8A8D\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),!1}}async function be(t,e,n){for(let s=0;s<n;s++){if(await de(t,e))return!0;await new Promise((r)=>setTimeout(r,1000))}return!1}async function W(t,e=!0,n=30){let s=process.env.REDIS_PASSWORD||"password",o=e?new d("Redis\u306E\u8D77\u52D5\u3092\u5F85\u6A5F\u3057\u3066\u3044\u307E\u3059"):null;if(o)o.start();try{if(await be(t,s,n))return E(o,!0,"Redis\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F"),!0;return E(o,!1,"Redis\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F"),!1}catch{return E(o,!1,"Redis\u306E\u8D77\u52D5\u78BA\u8A8D\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),!1}}async function we(t,e,n){if(await bt(t)){c("MySQL\u30B3\u30F3\u30C6\u30CA\u306F\u65E2\u306B\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059","success"),await Y(t,n);return}c("MySQL\u30B3\u30F3\u30C6\u30CA\u3092\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info"),await b`docker start ${t}`.cwd(e).quiet(),await Y(t,n)}async function xe(t,e,n){c("MySQL\u30B3\u30F3\u30C6\u30CA\u3092\u4F5C\u6210\u3057\u3066\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info");let s=process.env.MYSQL_ROOT_PASSWORD||"rootpassword",o=process.env.MYSQL_DATABASE||"portfolio",r=process.env.MYSQL_USER||"user",l=process.env.MYSQL_PASSWORD||"password";if(await b`docker run -d \
        --name ${t} \
        -p 3306:3306 \
        -e MYSQL_ROOT_PASSWORD=${s} \
        -e MYSQL_DATABASE=${o} \
        -e MYSQL_USER=${r} \
        -e MYSQL_PASSWORD=${l} \
        -v db-data:/var/lib/mysql \
        db`.cwd(e).quiet(),c("MySQL\u30B3\u30F3\u30C6\u30CA\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F","success"),!await Y(t,n))c("MySQL\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F","warning")}async function ve(t,e,n){if(await bt(t)){c("Redis\u30B3\u30F3\u30C6\u30CA\u306F\u65E2\u306B\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059","success"),await W(t,n);return}c("Redis\u30B3\u30F3\u30C6\u30CA\u3092\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info"),await b`docker start ${t}`.cwd(e).quiet(),await W(t,n)}async function Se(t,e,n){c("Redis\u30B3\u30F3\u30C6\u30CA\u3092\u4F5C\u6210\u3057\u3066\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info");let s=process.env.REDIS_PASSWORD||"password";if(await b`docker run -d \
        --name ${t} \
        -p 6379:6379 \
        -e REDIS_PASSWORD=${s} \
        -v cache-data:/data \
        cache`.cwd(e).quiet(),c("Redis\u30B3\u30F3\u30C6\u30CA\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F","success"),!await W(t,n))c("Redis\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F","warning")}async function ye(t,e=!0){let s=O(t,".docker/db"),o=O(s,"Dockerfile");if(!z(o)){c("MySQL Dockerfile\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093","warning");return}try{if(!await dt()){c("Docker\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093","warning");return}if(await K("db"))c("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");else if(e)await ae(t,o,s);else await ce(t,o,s);if(await gt("db")){await we("db",t,e);return}await xe("db",t,e)}catch(r){if(c("MySQL\u30B3\u30F3\u30C6\u30CA\u306E\u8D77\u52D5\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),process.env.DEBUG)console.error(r)}}async function Ce(t,e=!0){let s=O(t,".docker/cache"),o=O(s,"Dockerfile");if(!z(o)){c("Redis Dockerfile\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093","warning");return}try{if(!await dt()){c("Docker\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093","warning");return}if(await K("cache"))c("Redis Docker\u30A4\u30E1\u30FC\u30B8\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");else if(e)await pe(t,o,s);else await fe(t,o,s);if(await gt("cache")){await ve("cache",t,e);return}await Se("cache",t,e)}catch(r){if(c("Redis\u30B3\u30F3\u30C6\u30CA\u306E\u8D77\u52D5\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),process.env.DEBUG)console.error(r)}}async function J(t,e=!0){v("\uD83D\uDC33 Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9");let n=O(t,".docker/e2e/Dockerfile");if(z(n))try{if(await K("e2e"))c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");else if(e)await ue(t,n);else await me(t,n)}catch(s){if(c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),process.env.DEBUG)console.error(s)}await ye(t,e),await Ce(t,e)}var wt=$(()=>{y()});var{$:$e}=globalThis.Bun;async function xt(t){v("\uD83D\uDCE6 \u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB");let e=new d("\u4F9D\u5B58\u95A2\u4FC2\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059");e.start();try{await $e`bun install --ignore-scripts`.cwd(t).quiet(),e.stop(!0,"\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(n){if(e.stop(!1,"\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),process.env.DEBUG)console.error(n);throw n}}var vt=$(()=>{y()});var{$:Z}=globalThis.Bun;import{existsSync as ke,readFileSync as Ee,writeFileSync as St}from"fs";import{join as X}from"path";async function Pe(t){try{return(await Z`docker ps --filter name=^${t}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===t}catch{return!1}}function Me(t){let e=t,n=e?.stderr?.toString()??e?.message??String(t);return Oe.exec(n)?.[1]?.trim()??null}function qe(t){return t.length>80?`${t.substring(0,77)}...`:t}function Ie(t){let e=t,n=e?.stderr?.toString()??e?.stdout?.toString()??e?.message??String(t);return Ae.some((s)=>s.test(n))}function yt(t,e){if(Ie(t))e.stop(!0,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F\uFF08\u4E00\u90E8\u306E\u8B66\u544A\u3042\u308A\uFF09");else e.stop(!1,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u306B\u5931\u6557\u3057\u307E\u3057\u305F");if(process.env.DEBUG){console.error(t);return}let s=Me(t);if(s)c(qe(s),"warning")}function _e(){let t=process.env.MYSQL_USER||"user",e=process.env.MYSQL_PASSWORD||"password",n=process.env.MYSQL_DATABASE||"portfolio",s=process.env.MYSQL_HOST||"localhost",o=process.env.MYSQL_PORT||"3306";return`mysql://${t}:${e}@${s}:${o}/${n}`}async function Te(t){let e=new d("\u30ED\u30FC\u30AB\u30EBMySQL\u306B\u5BFE\u3057\u3066\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u3092\u5B9F\u884C\u3057\u3066\u3044\u307E\u3059");e.start();let n=X(t,"packages/db"),s=X(n,"prisma/schema/schema.prisma");if(!ke(s)){e.stop(!1,"\u30B9\u30AD\u30FC\u30DE\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");return}let o=_e(),r=Ee(s,"utf-8"),l=r.replace(/provider\s*=\s*"sqlite"/,'provider = "mysql"');St(s,l);try{await Z`DATABASE_URL=${o} bun run deploy`.cwd(n).quiet(),e.stop(!0,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(u){yt(u,e)}finally{St(s,r)}}async function He(t){let e=new d("Cloudflare D1\u306B\u5BFE\u3057\u3066\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u3092\u5B9F\u884C\u3057\u3066\u3044\u307E\u3059");e.start();let n=X(t,"packages/db");try{await Z`bun run migrate`.cwd(n).quiet(),e.stop(!0,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(s){yt(s,e)}}async function Ct(t){if(v("\uD83D\uDD04 \u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3"),await Pe("db"))await Te(t);else await He(t)}var Oe,Re,Ae;var $t=$(()=>{y();Oe=/Error:\s*([^\n]+)/,Re=/Duplicate key name/i,Ae=[Re]});var{$:kt}=globalThis.Bun;import{join as Et}from"path";async function N(t,e=!0){if(v("\uD83D\uDDC4\uFE0F  Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210"),e){let n=new d("Prisma\u30B9\u30AD\u30FC\u30DE\u3092\u751F\u6210\u3057\u3066\u3044\u307E\u3059");n.start();try{await kt`bun run generate`.cwd(Et(t,"packages/db")).quiet(),n.stop(!0,"Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(s){n.stop(!1,"Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),Ot(s)}}else{m("\uD83D\uDDC4\uFE0F","Prisma\u30B9\u30AD\u30FC\u30DE\u3092\u751F\u6210\u3057\u3066\u3044\u307E\u3059...","info");try{await kt`bun run generate`.cwd(Et(t,"packages/db")).quiet(),m("","Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(n){m("","Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),Ot(n)}}}function Ot(t){if(process.env.DEBUG){console.error(t);return}let e=t,n=e?.stderr?.toString()??e?.message??String(t),s=Ue.exec(n);if(s?.[1]){let o=s[1].trim(),r=o.length>80?`${o.substring(0,77)}...`:o;c(r,"warning")}}var Ue;var Rt=$(()=>{y();Ue=/Error:\s*([^\n]+)/});var{$:x}=globalThis.Bun;import{existsSync as At}from"fs";import{createInterface as je}from"readline";async function qt(t){let e=process.env.PATH||"",n=t,s="",o=!0;if(t==="pulumi"){let r=process.env.HOME||process.env.USERPROFILE||"~",l=`${r}/.pulumi/bin`,u=`${l}/pulumi`;if(At(u)){if(!e.includes(l))o=!1;n=u}else if(At(l))s=`${l}:`,process.env.PATH=`${s}${e}`;else return{installed:!1,inPath:!1};process.env.PULUMI_HOME=`${r}/.pulumi`}try{return await x`${n} ${t==="pulumi"?"version":"--version"}`.quiet(),{installed:!0,inPath:o}}catch{return{installed:!1,inPath:!1}}}async function Fe(t){let e=je({input:process.stdin,output:process.stdout});return new Promise((n)=>{e.question(t,(s)=>{e.close();let o=s.trim().toLowerCase();n(o==="y"||o==="yes"||o==="\u306F\u3044")})})}async function Ge(){m("","nvm\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059...","info");try{await x`curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash`.quiet(),m("","nvm\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success"),m("","\u30B7\u30A7\u30EB\u3092\u518D\u8D77\u52D5\u3059\u308B\u304B\u3001\u4EE5\u4E0B\u306E\u30B3\u30DE\u30F3\u30C9\u3092\u5B9F\u884C\u3057\u3066\u304F\u3060\u3055\u3044:","info"),console.log(g.default.dim(String.raw`    export NVM_DIR="$HOME/.nvm"`)),console.log(g.default.dim(String.raw`    [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"`)),console.log(g.default.dim(String.raw`    nvm install --lts`)),console.log(),console.log(g.default.yellow("  \u6CE8\u610F: node\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u306F\u30B7\u30A7\u30EB\u306E\u518D\u8D77\u52D5\u304C\u5FC5\u8981\u3067\u3059\u3002"))}catch(t){throw m("","nvm\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F","error"),t}}async function Ve(){if(process.platform==="darwin")throw m("","macOS\u3067\u306FDocker Desktop\u304C\u5FC5\u8981\u3067\u3059\u3002get.docker.com\u30B9\u30AF\u30EA\u30D7\u30C8\u306F\u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u305B\u3093","warning"),m("","Docker Desktop\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u304F\u3060\u3055\u3044: https://www.docker.com/products/docker-desktop","info"),new Error("macOS\u3067\u306FDocker Desktop\u304C\u5FC5\u8981\u3067\u3059\u3002get.docker.com\u30B9\u30AF\u30EA\u30D7\u30C8\u306F\u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u305B\u3093");let t=new d("Docker\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059...");t.start();try{if((await x`curl -fsSL https://get.docker.com/ | sh`.quiet()).exitCode!==0)throw t.stop(!1),new Error("Docker\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F");t.stop(!0,"Docker\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(e){throw t.stop(!1),m("","Docker\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F","error"),e}}async function Le(){try{return await x`which gpg`.quiet(),!0}catch{return!1}}async function Qe(){if(!await Le()){if(m("","Doppler CLI\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u306FGnuPG\u304C\u5FC5\u8981\u3067\u3059\u3002gpg\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093","error"),m("","GnuPG\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u304F\u3060\u3055\u3044:","info"),process.platform==="darwin")console.log(g.default.dim("    brew install gnupg"));else console.log(g.default.dim("    apt-get install gnupg  # Debian/Ubuntu")),console.log(g.default.dim("    yum install gnupg       # RHEL/CentOS"));throw new Error("Doppler CLI\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u306FGnuPG\u304C\u5FC5\u8981\u3067\u3059\u3002gpg\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093")}let e=new d("Doppler CLI\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059...");e.start();try{let s=`${process.env.HOME||process.env.USERPROFILE||"~"}/.local/bin`;await x`mkdir -p ${s}`.quiet();let o=await x`bash -c "curl -Ls --tlsv1.2 --proto '=https' --retry 3 https://cli.doppler.com/install.sh | sh -s -- --install-path ${s}"`.quiet();if(o.exitCode!==0){let r=o.stderr.toString()||o.stdout.toString();throw e.stop(!1),new Error(`\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F: ${r}`)}e.stop(!0,"Doppler CLI\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F"),m("",`Doppler CLI\u306F ${s} \u306B\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u307E\u3057\u305F`,"info"),m("","PATH\u306B\u8FFD\u52A0\u3059\u308B\u306B\u306F\u3001\u30B7\u30A7\u30EB\u8A2D\u5B9A\u30D5\u30A1\u30A4\u30EB\u306B\u4EE5\u4E0B\u3092\u8FFD\u52A0\u3057\u3066\u304F\u3060\u3055\u3044:","info"),console.log(g.default.dim(String.raw`    export PATH="$HOME/.local/bin:$PATH"`))}catch(n){if(e.stop(!1),m("","Doppler CLI\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F","error"),n instanceof Error)console.error(g.default.dim(`  \u30A8\u30E9\u30FC: ${n.message}`));throw n}}async function Ye(){let t=new d("Codex CLI\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059...");t.start();try{let e=await fetch("https://api.github.com/repos/openai/codex/releases/latest");if(!e.ok)throw t.stop(!1),new Error(`GitHub API\u30A8\u30E9\u30FC: ${e.status}`);let n=await e.json(),r=(await x`uname -m`.quiet()).stdout.toString().trim()==="arm64"?"aarch64":"x86_64",l=`codex-${r}-apple-darwin.tar.gz`,u=n.assets.find((Gt)=>Gt.name===l);if(!u)throw t.stop(!1),new Error(`\u30A2\u30BB\u30C3\u30C8\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093: ${l}`);let i=`/tmp/${l}`;if((await x`curl -fsSL -o ${i} ${u.browser_download_url}`.quiet()).exitCode!==0)throw t.stop(!1),new Error("\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F");let h=await x`tar -xzf ${i} -C /tmp`.quiet();if(h.exitCode!==0)throw t.stop(!1),new Error(`\u89E3\u51CD\u306B\u5931\u6557\u3057\u307E\u3057\u305F: ${h.stderr.toString()}`);let w=`/tmp/${`codex-${r}-apple-darwin`}`;if((await x`test -f ${w}`.quiet()).exitCode!==0)throw t.stop(!1),new Error(`\u89E3\u51CD\u5F8C\u306Ecodex\u30D0\u30A4\u30CA\u30EA\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093: ${w}`);let C=`${process.env.HOME||process.env.USERPROFILE||"~"}/.local/bin`;if(await x`mkdir -p ${C}`.quiet(),(await x`mv ${w} ${C}/codex`.quiet()).exitCode!==0)throw t.stop(!1),new Error("\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F");await x`chmod +x ${C}/codex`.quiet(),await x`rm ${i}`.quiet(),t.stop(!0,`Codex CLI ${n.tag_name} \u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F`),m("",`Codex CLI\u306F ${C} \u306B\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u307E\u3057\u305F`,"info"),m("","PATH\u306B\u8FFD\u52A0\u3059\u308B\u306B\u306F\u3001\u30B7\u30A7\u30EB\u8A2D\u5B9A\u30D5\u30A1\u30A4\u30EB\u306B\u4EE5\u4E0B\u3092\u8FFD\u52A0\u3057\u3066\u304F\u3060\u3055\u3044:","info"),console.log(g.default.dim(String.raw`    export PATH="$HOME/.local/bin:$PATH"`))}catch(e){if(t.stop(!1),m("","Codex CLI\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F","error"),e instanceof Error)console.error(g.default.dim(`  \u30A8\u30E9\u30FC: ${e.message}`));throw e}}async function We(t){if(typeof t.installScript==="string"){let e=new d(`${t.name}\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059...`);e.start();try{let n=await x`bash -c ${t.installScript}`.quiet();if(n.exitCode!==0){let s=n.stderr.toString()||n.stdout.toString();if(e.stop(!1),m("",`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F`,"error"),s)console.error(g.default.dim(`  \u30A8\u30E9\u30FC\u51FA\u529B: ${s.trim()}`));throw new Error(`\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u30B9\u30AF\u30EA\u30D7\u30C8\u304C\u7D42\u4E86\u30B3\u30FC\u30C9 ${n.exitCode} \u3067\u7D42\u4E86\u3057\u307E\u3057\u305F`)}e.stop(!0,`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F`)}catch(n){if(e.stop(!1),m("",`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F`,"error"),n instanceof Error)console.error(g.default.dim(`  \u30A8\u30E9\u30FC: ${n.message}`));if(process.env.DEBUG)console.error(n);throw n}}else await t.installScript()}function ze(t){if(t!=="pulumi")return;let e=process.env.HOME||process.env.USERPROFILE||"~";if(m("","PATH\u306B\u8FFD\u52A0\u3059\u308B\u306B\u306F\u3001\u30B7\u30A7\u30EB\u8A2D\u5B9A\u30D5\u30A1\u30A4\u30EB\u306B\u4EE5\u4E0B\u3092\u8FFD\u52A0\u3057\u3066\u304F\u3060\u3055\u3044:","info"),(process.env.SHELL||"").includes("fish"))console.log(g.default.dim(String.raw`    fish_add_path ${e}/.pulumi/bin`));else console.log(g.default.dim(String.raw`    export PATH="$HOME/.pulumi/bin:$PATH"`))}function It(t,e,n){let s=n?`${t.name}\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u3059`:`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u78BA\u8A8D\u3055\u308C\u307E\u3057\u305F`;if(e)m("",s,"success");else{let o=n?`${t.name}\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u3059\u304C\u3001PATH\u306B\u542B\u307E\u308C\u3066\u3044\u307E\u305B\u3093`:`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u78BA\u8A8D\u3055\u308C\u307E\u3057\u305F\u304C\u3001PATH\u306B\u542B\u307E\u308C\u3066\u3044\u307E\u305B\u3093`;m("",o,"warning"),ze(t.name)}}async function Ke(t,e){let n=e?"\uFF08\u30AA\u30D7\u30B7\u30E7\u30F3\uFF09":"",s=`${t.name}\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093${n}\u3002\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u307E\u3059\u304B\uFF1F (y/n): `;if(!await Fe(s)){let r=e?"info":"warning";return m("",`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3092\u30B9\u30AD\u30C3\u30D7\u3057\u307E\u3057\u305F`,r),!1}return!0}async function Je(t){try{await We(t);let{installed:e,inPath:n}=await qt(t.checkCommand);if(e)It(t,n,!1);else m("",`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u5F8C\u3001\u30B3\u30DE\u30F3\u30C9\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002\u30B7\u30A7\u30EB\u3092\u518D\u8D77\u52D5\u3057\u3066\u304F\u3060\u3055\u3044`,"warning")}catch(e){if(m("",`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F`,"error"),e instanceof Error)console.error(g.default.dim(`  \u30A8\u30E9\u30FC: ${e.message}`));if(process.env.DEBUG)console.error(e)}}async function Xe(t,e){let{installed:n,inPath:s}=await qt(t.checkCommand);if(n){It(t,s,!0);return}if(!await Ke(t,e))return;await Je(t)}async function Mt(t,e){if(e&&t.length>0)console.log(),m("","\u30AA\u30D7\u30B7\u30E7\u30F3\u30B3\u30DE\u30F3\u30C9\u306E\u78BA\u8A8D","info");for(let n of t){if(!n)continue;await Xe(n,e)}}async function _(){v("\uD83D\uDD0D \u30B3\u30DE\u30F3\u30C9\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u78BA\u8A8D");let t=Pt.filter((n)=>n.required),e=Pt.filter((n)=>!n.required);await Mt(t,!1),await Mt(e,!0),console.log(),m("","\u30B3\u30DE\u30F3\u30C9\u306E\u78BA\u8A8D\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}var g,Pt;var B=$(()=>{g=j(I(),1);y();Pt=[{name:"node",checkCommand:"node",installScript:Ge,description:"Node.js (nvm\u7D4C\u7531)",required:!0},{name:"bun",checkCommand:"bun",installScript:"curl -fsSL https://bun.sh/install | bash",description:"Bun",required:!0},{name:"docker",checkCommand:"docker",installScript:Ve,description:"Docker",required:!0},{name:"pulumi",checkCommand:"pulumi",installScript:"curl -fsSL https://get.pulumi.com | sh",description:"Pulumi",required:!0},{name:"doppler",checkCommand:"doppler",installScript:Qe,description:"Doppler CLI",required:!0},{name:"coderabbit",checkCommand:"coderabbit",installScript:"curl -fsSL https://cli.coderabbit.ai/install.sh | sh",description:"CodeRabbit CLI",required:!1},{name:"claude",checkCommand:"claude",installScript:"curl -fsSL https://claude.ai/install.sh | bash",description:"Claude Code",required:!1},{name:"codex",checkCommand:"codex",installScript:Ye,description:"Codex CLI",required:!1}]});var Ut={};nt(Ut,{runWorkspace:()=>tt,findRootDir:()=>T});var{$:_t}=globalThis.Bun;import{existsSync as Tt}from"fs";import{join as Ht,resolve as D}from"path";function T(t=process.cwd()){let e=D(t),n=D("/");while(e!==n){let s=Ht(e,"package.json"),o=Ht(e,"turbo.json");if(Tt(s)&&Tt(o))return e;e=D(e,"..")}return process.cwd()}async function Ze(){if(process.versions?.bun!==void 0)return!0;try{if(_t!==void 0)return await _t`bun --version`.quiet(),!0}catch{return!1}return!1}function Ne(t){return!t.env&&!t.install&&!t.schema&&!t.docker&&!t.migrate}function Be(t){let e=Ne(t);return{runEnv:e||t.env!==!1,runInstall:e||t.install!==!1,runSchema:e||t.schema!==!1,runDocker:e||t.docker!==!1,runMigrate:e||t.migrate!==!1,parallel:t.parallel??!0}}function De(){console.log(),console.log(f.default.bold(f.default.cyan("  \u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E"))),console.log(f.default.bold(f.default.cyan("  \u2502  \uD83D\uDE80 \u958B\u767A\u74B0\u5883\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3092\u958B\u59CB\u3057\u307E\u3059      \u2502"))),console.log(f.default.bold(f.default.cyan("  \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F")))}function tn(){console.log(),console.log(f.default.bold(f.default.green("  \u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E"))),console.log(f.default.bold(f.default.green("  \u2502  \u2705 \u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F\uFF01            \u2502"))),console.log(f.default.bold(f.default.green("  \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F"))),console.log(),console.log(f.default.bold("  \u6B21\u306E\u30B9\u30C6\u30C3\u30D7:")),console.log(f.default.dim("    \u2022 .env\u30D5\u30A1\u30A4\u30EB\u3092\u7DE8\u96C6\u3057\u3066\u74B0\u5883\u5909\u6570\u3092\u8A2D\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044")),console.log(f.default.dim("    \u2022 bun run dev \u3067\u958B\u767A\u30B5\u30FC\u30D0\u30FC\u3092\u8D77\u52D5\u3067\u304D\u307E\u3059")),console.log()}function en(t){console.log(),console.error(f.default.bold(f.default.red("  \u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E"))),console.error(f.default.bold(f.default.red("  \u2502  \u2717 \u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F    \u2502"))),console.error(f.default.bold(f.default.red("  \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F"))),console.error(),console.error(f.default.red("  "),t),console.error()}async function nn(t,e){if(!e)return;if(process.env.BUN_LIFECYCLE_EVENT==="prepare"){let{logSection:s}=await Promise.resolve().then(() => (y(),ht));s("\uD83D\uDCE6 \u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB"),m("","\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3092\u30B9\u30AD\u30C3\u30D7\u3057\u307E\u3057\u305F\uFF08prepare\u30B9\u30AF\u30EA\u30D7\u30C8\u304B\u3089\u5B9F\u884C\u4E2D\uFF09","info");return}await xt(t)}async function sn(t,e,n,s){let o=!s;if(s&&(e||n)){let r=[];if(e)r.push(N(t,o));if(n)r.push(J(t,o));await Promise.all(r);return}if(e)await N(t,o);if(n)await J(t,o)}async function tt(t={}){let e=T(),n=Be(t);if(De(),!await Ze())console.log(),console.error(f.default.red("  \u2717 Bun\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093\u3002")),console.error(f.default.dim("    Bun\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u304F\u3060\u3055\u3044: https://bun.sh")),process.exit(1);m("","Bun\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u3059","success");try{if(await _(),n.runEnv)await Q(e);if(await nn(e,n.runInstall),await sn(e,n.runSchema,n.runDocker,n.parallel),n.runMigrate)await Ct(e);tn()}catch(o){en(o),process.exit(1)}}var f;var et=$(()=>{f=j(I(),1);wt();y();vt();$t();Rt();B()});import{EventEmitter as zt}from"events";function F(t){return t==null?[]:Array.isArray(t)?t:[t]}function Kt(t,e,n,s){var o,r=t[e],l=~s.string.indexOf(e)?n==null||n===!0?"":String(n):typeof n==="boolean"?n:~s.boolean.indexOf(e)?n==="false"?!1:n==="true"||(t._.push((o=+n,o*0===0)?o:n),!!n):(o=+n,o*0===0)?o:n;t[e]=r==null?l:Array.isArray(r)?r.concat(l):[r,l]}function Jt(t,e){t=t||[],e=e||{};var n,s,o,r,l,u={_:[]},i=0,a=0,h=0,p=t.length;let w=e.alias!==void 0,R=e.unknown!==void 0,H=e.default!==void 0;if(e.alias=e.alias||{},e.string=F(e.string),e.boolean=F(e.boolean),w)for(n in e.alias){s=e.alias[n]=F(e.alias[n]);for(i=0;i<s.length;i++)(e.alias[s[i]]=s.concat(n)).splice(i,1)}for(i=e.boolean.length;i-- >0;){s=e.alias[e.boolean[i]]||[];for(a=s.length;a-- >0;)e.boolean.push(s[a])}for(i=e.string.length;i-- >0;){s=e.alias[e.string[i]]||[];for(a=s.length;a-- >0;)e.string.push(s[a])}if(H){for(n in e.default)if(r=typeof e.default[n],s=e.alias[n]=e.alias[n]||[],e[r]!==void 0){e[r].push(n);for(i=0;i<s.length;i++)e[r].push(s[i])}}let C=R?Object.keys(e.alias):[];for(i=0;i<p;i++){if(o=t[i],o==="--"){u._=u._.concat(t.slice(++i));break}for(a=0;a<o.length;a++)if(o.charCodeAt(a)!==45)break;if(a===0)u._.push(o);else if(o.substring(a,a+3)==="no-"){if(r=o.substring(a+3),R&&!~C.indexOf(r))return e.unknown(o);u[r]=!1}else{for(h=a+1;h<o.length;h++)if(o.charCodeAt(h)===61)break;r=o.substring(a,h),l=o.substring(++h)||(i+1===p||(""+t[i+1]).charCodeAt(0)===45||t[++i]),s=a===2?[r]:r;for(h=0;h<s.length;h++){if(r=s[h],R&&!~C.indexOf(r))return e.unknown("-".repeat(a)+r);Kt(u,r,h+1<s.length||l,e)}}}if(H){for(n in e.default)if(u[n]===void 0)u[n]=e.default[n]}if(w)for(n in u){s=e.alias[n]||[];while(s.length>0)u[s.shift()]=u[n]}return u}var rt=(t)=>t.replace(/[<[].+/,"").trim(),Xt=(t)=>{let e=/<([^>]+)>/g,n=/\[([^\]]+)\]/g,s=[],o=(u)=>{let i=!1,a=u[1];if(a.startsWith("..."))a=a.slice(3),i=!0;return{required:u[0].startsWith("<"),value:a,variadic:i}},r;while(r=e.exec(t))s.push(o(r));let l;while(l=n.exec(t))s.push(o(l));return s},Zt=(t)=>{let e={alias:{},boolean:[]};for(let[n,s]of t.entries()){if(s.names.length>1)e.alias[s.names[0]]=s.names.slice(1);if(s.isBoolean)if(s.negated){if(!t.some((r,l)=>{return l!==n&&r.names.some((u)=>s.names.includes(u))&&typeof r.required==="boolean"}))e.boolean.push(s.names[0])}else e.boolean.push(s.names[0])}return e},st=(t)=>{return t.sort((e,n)=>{return e.length>n.length?-1:1})[0]},ot=(t,e)=>{return t.length>=e?t:`${t}${" ".repeat(e-t.length)}`},Nt=(t)=>{return t.replace(/([a-z])-([a-z])/g,(e,n,s)=>{return n+s.toUpperCase()})},Bt=(t,e,n)=>{let s=0,o=e.length,r=t,l;for(;s<o;++s)l=r[e[s]],r=r[e[s]]=s===o-1?n:l!=null?l:!!~e[s+1].indexOf(".")||!(+e[s+1]>-1)?{}:[]},Dt=(t,e)=>{for(let n of Object.keys(e)){let s=e[n];if(s.shouldTransform){if(t[n]=Array.prototype.concat.call([],t[n]),typeof s.transformFunction==="function")t[n]=t[n].map(s.transformFunction)}}},te=(t)=>{let e=/([^\\\/]+)$/.exec(t);return e?e[1]:""},it=(t)=>{return t.split(".").map((e,n)=>{return n===0?Nt(e):e}).join(".")};class P extends Error{constructor(t){super(t);if(this.name=this.constructor.name,typeof Error.captureStackTrace==="function")Error.captureStackTrace(this,this.constructor);else this.stack=new Error(t).stack}}class lt{constructor(t,e,n){if(this.rawName=t,this.description=e,this.config=Object.assign({},n),t=t.replace(/\.\*/g,""),this.negated=!1,this.names=rt(t).split(",").map((s)=>{let o=s.trim().replace(/^-{1,2}/,"");if(o.startsWith("no-"))this.negated=!0,o=o.replace(/^no-/,"");return it(o)}).sort((s,o)=>s.length>o.length?1:-1),this.name=this.names[this.names.length-1],this.negated&&this.config.default==null)this.config.default=!0;if(t.includes("<"))this.required=!0;else if(t.includes("["))this.required=!1;else this.isBoolean=!0}}var ee=process.argv,ne=`${process.platform}-${process.arch} node-${process.version}`;class G{constructor(t,e,n={},s){this.rawName=t,this.description=e,this.config=n,this.cli=s,this.options=[],this.aliasNames=[],this.name=rt(t),this.args=Xt(t),this.examples=[]}usage(t){return this.usageText=t,this}allowUnknownOptions(){return this.config.allowUnknownOptions=!0,this}ignoreOptionDefaultValue(){return this.config.ignoreOptionDefaultValue=!0,this}version(t,e="-v, --version"){return this.versionNumber=t,this.option(e,"Display version number"),this}example(t){return this.examples.push(t),this}option(t,e,n){let s=new lt(t,e,n);return this.options.push(s),this}alias(t){return this.aliasNames.push(t),this}action(t){return this.commandAction=t,this}isMatched(t){return this.name===t||this.aliasNames.includes(t)}get isDefaultCommand(){return this.name===""||this.aliasNames.includes("!")}get isGlobalCommand(){return this instanceof V}hasOption(t){return t=t.split(".")[0],this.options.find((e)=>{return e.names.includes(t)})}outputHelp(){let{name:t,commands:e}=this.cli,{versionNumber:n,options:s,helpCallback:o}=this.cli.globalCommand,r=[{body:`${t}${n?`/${n}`:""}`}];if(r.push({title:"Usage",body:`  $ ${t} ${this.usageText||this.rawName}`}),(this.isGlobalCommand||this.isDefaultCommand)&&e.length>0){let i=st(e.map((a)=>a.rawName));r.push({title:"Commands",body:e.map((a)=>{return`  ${ot(a.rawName,i.length)}  ${a.description}`}).join(`
`)}),r.push({title:"For more info, run any command with the `--help` flag",body:e.map((a)=>`  $ ${t}${a.name===""?"":` ${a.name}`} --help`).join(`
`)})}let u=this.isGlobalCommand?s:[...this.options,...s||[]];if(!this.isGlobalCommand&&!this.isDefaultCommand)u=u.filter((i)=>i.name!=="version");if(u.length>0){let i=st(u.map((a)=>a.rawName));r.push({title:"Options",body:u.map((a)=>{return`  ${ot(a.rawName,i.length)}  ${a.description} ${a.config.default===void 0?"":`(default: ${a.config.default})`}`}).join(`
`)})}if(this.examples.length>0)r.push({title:"Examples",body:this.examples.map((i)=>{if(typeof i==="function")return i(t);return i}).join(`
`)});if(o)r=o(r)||r;console.log(r.map((i)=>{return i.title?`${i.title}:
${i.body}`:i.body}).join(`

`))}outputVersion(){let{name:t}=this.cli,{versionNumber:e}=this.cli.globalCommand;if(e)console.log(`${t}/${e} ${ne}`)}checkRequiredArgs(){let t=this.args.filter((e)=>e.required).length;if(this.cli.args.length<t)throw new P(`missing required args for command \`${this.rawName}\``)}checkUnknownOptions(){let{options:t,globalCommand:e}=this.cli;if(!this.config.allowUnknownOptions){for(let n of Object.keys(t))if(n!=="--"&&!this.hasOption(n)&&!e.hasOption(n))throw new P(`Unknown option \`${n.length>1?`--${n}`:`-${n}`}\``)}}checkOptionValue(){let{options:t,globalCommand:e}=this.cli,n=[...e.options,...this.options];for(let s of n){let o=t[s.name.split(".")[0]];if(s.required){let r=n.some((l)=>l.negated&&l.names.includes(s.name));if(o===!0||o===!1&&!r)throw new P(`option \`${s.rawName}\` value is missing`)}}}}class V extends G{constructor(t){super("@@global@@","",{},t)}}var A=Object.assign;class at extends zt{constructor(t=""){super();this.name=t,this.commands=[],this.rawArgs=[],this.args=[],this.options={},this.globalCommand=new V(this),this.globalCommand.usage("<command> [options]")}usage(t){return this.globalCommand.usage(t),this}command(t,e,n){let s=new G(t,e||"",n,this);return s.globalCommand=this.globalCommand,this.commands.push(s),s}option(t,e,n){return this.globalCommand.option(t,e,n),this}help(t){return this.globalCommand.option("-h, --help","Display this message"),this.globalCommand.helpCallback=t,this.showHelpOnExit=!0,this}version(t,e="-v, --version"){return this.globalCommand.version(t,e),this.showVersionOnExit=!0,this}example(t){return this.globalCommand.example(t),this}outputHelp(){if(this.matchedCommand)this.matchedCommand.outputHelp();else this.globalCommand.outputHelp()}outputVersion(){this.globalCommand.outputVersion()}setParsedInfo({args:t,options:e},n,s){if(this.args=t,this.options=e,n)this.matchedCommand=n;if(s)this.matchedCommandName=s;return this}unsetMatchedCommand(){this.matchedCommand=void 0,this.matchedCommandName=void 0}parse(t=ee,{run:e=!0}={}){if(this.rawArgs=t,!this.name)this.name=t[1]?te(t[1]):"cli";let n=!0;for(let o of this.commands){let r=this.mri(t.slice(2),o),l=r.args[0];if(o.isMatched(l)){n=!1;let u=A(A({},r),{args:r.args.slice(1)});this.setParsedInfo(u,o,l),this.emit(`command:${l}`,o)}}if(n){for(let o of this.commands)if(o.name===""){n=!1;let r=this.mri(t.slice(2),o);this.setParsedInfo(r,o),this.emit("command:!",o)}}if(n){let o=this.mri(t.slice(2));this.setParsedInfo(o)}if(this.options.help&&this.showHelpOnExit)this.outputHelp(),e=!1,this.unsetMatchedCommand();if(this.options.version&&this.showVersionOnExit&&this.matchedCommandName==null)this.outputVersion(),e=!1,this.unsetMatchedCommand();let s={args:this.args,options:this.options};if(e)this.runMatchedCommand();if(!this.matchedCommand&&this.args[0])this.emit("command:*");return s}mri(t,e){let n=[...this.globalCommand.options,...e?e.options:[]],s=Zt(n),o=[],r=t.indexOf("--");if(r>-1)o=t.slice(r+1),t=t.slice(0,r);let l=Jt(t,s);l=Object.keys(l).reduce((p,w)=>{return A(A({},p),{[it(w)]:l[w]})},{_:[]});let u=l._,i={"--":o},a=e&&e.config.ignoreOptionDefaultValue?e.config.ignoreOptionDefaultValue:this.globalCommand.config.ignoreOptionDefaultValue,h=Object.create(null);for(let p of n){if(!a&&p.config.default!==void 0)for(let w of p.names)i[w]=p.config.default;if(Array.isArray(p.config.type)){if(h[p.name]===void 0)h[p.name]=Object.create(null),h[p.name].shouldTransform=!0,h[p.name].transformFunction=p.config.type[0]}}for(let p of Object.keys(l))if(p!=="_"){let w=p.split(".");Bt(i,w,l[p]),Dt(i,h)}return{args:u,options:i}}runMatchedCommand(){let{args:t,options:e,matchedCommand:n}=this;if(!n||!n.commandAction)return;n.checkUnknownOptions(),n.checkOptionValue(),n.checkRequiredArgs();let s=[];return n.args.forEach((o,r)=>{if(o.variadic)s.push(t.slice(r));else s.push(t[r])}),s.push(e),n.commandAction.apply(this,s)}}var ct=(t="")=>new at(t);et();y();var{$:on,spawn:rn}=globalThis.Bun;import{existsSync as ln,readdirSync as an,readFileSync as cn}from"fs";import{join as jt}from"path";var un=/Error:\s*([^\n]+)/;async function mn(t){try{return(await on`docker ps --filter name=^${t}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===t}catch{return!1}}function pn(t){let e=t,n=e?.stderr?.toString()??e?.message??String(t);return un.exec(n)?.[1]?.trim()??null}function fn(t){return t.length>80?`${t.substring(0,77)}...`:t}function hn(t,e){if(e.stop(!1,"\u30B7\u30FC\u30C9\u30C7\u30FC\u30BF\u306E\u6295\u5165\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),process.env.DEBUG){console.error(t);return}let n=pn(t);if(n)c(fn(n),"warning")}async function dn(t){let e=new d("\u30ED\u30FC\u30AB\u30EBMySQL\u306B\u30B7\u30FC\u30C9\u30C7\u30FC\u30BF\u3092\u6295\u5165\u3057\u3066\u3044\u307E\u3059");e.start();let n=jt(t,".docker/db/seed");if(!ln(n)){e.stop(!1,"\u30B7\u30FC\u30C9\u30C7\u30A3\u30EC\u30AF\u30C8\u30EA\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");return}let s=an(n).filter((i)=>i.endsWith(".sql")).sort((i,a)=>i.localeCompare(a)).map((i)=>jt(n,i));if(s.length===0){e.stop(!1,"\u30B7\u30FC\u30C9\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");return}let o=process.env.MYSQL_USER||"user",r=process.env.MYSQL_PASSWORD||"password",l=process.env.MYSQL_DATABASE||"portfolio",u="db";try{for(let i of s){let a=i.split("/").pop()||i;c(`\u5B9F\u884C\u4E2D: ${a}`,"info");let h=cn(i,"utf-8"),p=rn(["docker","exec","-i",u,"mysql","-u",o,`-p${r}`,l],{stdin:"pipe",stdout:"pipe",stderr:"pipe"});if(p.stdin.write(h),p.stdin.end(),await p.exited,p.exitCode!==0){let w=await p.stderr.text();throw new Error(`Failed to execute seed file ${a}: ${w}`)}}e.stop(!0,"\u30B7\u30FC\u30C9\u30C7\u30FC\u30BF\u306E\u6295\u5165\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(i){throw hn(i,e),i}}async function Ft(t){if(v("\uD83C\uDF31 \u30B7\u30FC\u30C9\u30C7\u30FC\u30BF\u306E\u6295\u5165"),!await mn("db")){c("MySQL\u30B3\u30F3\u30C6\u30CA\u304C\u8D77\u52D5\u3057\u3066\u3044\u307E\u305B\u3093","warning"),c("\u30B3\u30F3\u30C6\u30CA\u3092\u8D77\u52D5\u3057\u3066\u304B\u3089\u518D\u5EA6\u5B9F\u884C\u3057\u3066\u304F\u3060\u3055\u3044","info");return}await dn(t)}B();var k=ct("workspace");k.command("setup","\u958B\u767A\u74B0\u5883\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3092\u5B9F\u884C\u3057\u307E\u3059").option("--env","\u74B0\u5883\u8A2D\u5B9A\u306E\u307F\u5B9F\u884C").option("--install","\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306E\u307F\u5B9F\u884C").option("--schema","Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u306E\u307F\u5B9F\u884C").option("--docker","Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306E\u307F\u5B9F\u884C").option("--migrate","\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u306E\u307F\u5B9F\u884C").option("--no-parallel","\u4E26\u5217\u5B9F\u884C\u3092\u7121\u52B9\u5316").action(async(t)=>{let e={env:t.env!==void 0,install:t.install!==void 0,schema:t.schema!==void 0,docker:t.docker!==void 0,migrate:t.migrate!==void 0,parallel:!t["no-parallel"]};await tt(e)});k.command("seed","\u30B7\u30FC\u30C9\u30C7\u30FC\u30BF\u3092\u6295\u5165\u3057\u307E\u3059").action(async()=>{let t=T();await Ft(t)});k.command("check","\u5FC5\u8981\u306A\u30B3\u30DE\u30F3\u30C9\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u78BA\u8A8D\u3068\u5BFE\u8A71\u7684\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3092\u5B9F\u884C\u3057\u307E\u3059").action(async()=>{await _()});k.command("*","\u958B\u767A\u74B0\u5883\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3092\u5B9F\u884C\u3057\u307E\u3059").action(async()=>{let{runWorkspace:t}=await Promise.resolve().then(() => (et(),Ut));await t()});k.help();k.version("1.0.1");k.parse();
