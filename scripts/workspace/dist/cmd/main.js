#!/usr/bin/env bun
// @bun
var bn=Object.create;var{getPrototypeOf:xn,defineProperty:A,getOwnPropertyNames:vn}=Object;var wn=Object.prototype.hasOwnProperty;var W=(n,e,t)=>{t=n!=null?bn(xn(n)):{};let s=e||!n||!n.__esModule?A(t,"default",{value:n,enumerable:!0}):t;for(let i of vn(n))if(!wn.call(s,i))A(s,i,{get:()=>n[i],enumerable:!0});return s};var yn=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var On=(n,e)=>{for(var t in e)A(n,t,{get:e[t],enumerable:!0,configurable:!0,set:(s)=>e[t]=()=>s})};var Cn=(n,e)=>()=>(n&&(e=n(n=0)),e);var T=yn((ke,R)=>{var E=process||{},D=E.argv||[],k=E.env||{},Pn=!(!!k.NO_COLOR||D.includes("--no-color"))&&(!!k.FORCE_COLOR||D.includes("--color")||E.platform==="win32"||(E.stdout||{}).isTTY&&k.TERM!=="dumb"||!!k.CI),qn=(n,e,t=n)=>(s)=>{let i=""+s,o=i.indexOf(e,n.length);return~o?n+Un(i,e,t,o)+e:n+i+e},Un=(n,e,t,s)=>{let i="",o=0;do i+=n.substring(o,s)+t,o=s+e.length,s=n.indexOf(e,o);while(~s);return i+n.substring(o)},nn=(n=Pn)=>{let e=n?qn:()=>String;return{isColorSupported:n,reset:e("\x1B[0m","\x1B[0m"),bold:e("\x1B[1m","\x1B[22m","\x1B[22m\x1B[1m"),dim:e("\x1B[2m","\x1B[22m","\x1B[22m\x1B[2m"),italic:e("\x1B[3m","\x1B[23m"),underline:e("\x1B[4m","\x1B[24m"),inverse:e("\x1B[7m","\x1B[27m"),hidden:e("\x1B[8m","\x1B[28m"),strikethrough:e("\x1B[9m","\x1B[29m"),black:e("\x1B[30m","\x1B[39m"),red:e("\x1B[31m","\x1B[39m"),green:e("\x1B[32m","\x1B[39m"),yellow:e("\x1B[33m","\x1B[39m"),blue:e("\x1B[34m","\x1B[39m"),magenta:e("\x1B[35m","\x1B[39m"),cyan:e("\x1B[36m","\x1B[39m"),white:e("\x1B[37m","\x1B[39m"),gray:e("\x1B[90m","\x1B[39m"),bgBlack:e("\x1B[40m","\x1B[49m"),bgRed:e("\x1B[41m","\x1B[49m"),bgGreen:e("\x1B[42m","\x1B[49m"),bgYellow:e("\x1B[43m","\x1B[49m"),bgBlue:e("\x1B[44m","\x1B[49m"),bgMagenta:e("\x1B[45m","\x1B[49m"),bgCyan:e("\x1B[46m","\x1B[49m"),bgWhite:e("\x1B[47m","\x1B[49m"),blackBright:e("\x1B[90m","\x1B[39m"),redBright:e("\x1B[91m","\x1B[39m"),greenBright:e("\x1B[92m","\x1B[39m"),yellowBright:e("\x1B[93m","\x1B[39m"),blueBright:e("\x1B[94m","\x1B[39m"),magentaBright:e("\x1B[95m","\x1B[39m"),cyanBright:e("\x1B[96m","\x1B[39m"),whiteBright:e("\x1B[97m","\x1B[39m"),bgBlackBright:e("\x1B[100m","\x1B[49m"),bgRedBright:e("\x1B[101m","\x1B[49m"),bgGreenBright:e("\x1B[102m","\x1B[49m"),bgYellowBright:e("\x1B[103m","\x1B[49m"),bgBlueBright:e("\x1B[104m","\x1B[49m"),bgMagentaBright:e("\x1B[105m","\x1B[49m"),bgCyanBright:e("\x1B[106m","\x1B[49m"),bgWhiteBright:e("\x1B[107m","\x1B[49m")}};R.exports=nn();R.exports.createColors=nn});var sn={};On(sn,{setupEnvFile:()=>I,logSubStep:()=>m,logStep:()=>p,logSection:()=>x,LoadingBar:()=>d});import{copyFileSync as Vn,existsSync as en,writeFileSync as Fn}from"fs";import{join as tn}from"path";function x(n){console.log(),console.log(g.default.bold(g.default.cyan(`  ${n}`))),console.log(g.default.dim(`  ${"\u2500".repeat(50)}`))}function p(n,e,t="info"){let s={info:g.default.blue,success:g.default.green,warning:g.default.yellow,error:g.default.red},i;if(t==="success")i="\u2713";else if(t==="error")i="\u2717";else if(t==="warning")i="\u26A0";else i="\u2192";console.log(`  ${s[t](i)} ${n} ${e}`)}function m(n,e="info"){let t={info:g.default.dim,success:g.default.green,warning:g.default.yellow},s;if(e==="success")s="\u2713";else if(e==="warning")s="\u26A0";else s="  ";console.log(`    ${t[e](s)} ${n}`)}class d{message;interval=null;frames=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"];frameIndex=0;isActive=!1;constructor(n){this.message=n}start(){if(this.isActive)return;this.isActive=!0,this.frameIndex=0,this.interval=setInterval(()=>{let n=this.frames[this.frameIndex%this.frames.length];process.stdout.write(`\r    ${g.default.cyan(n)} ${g.default.dim(this.message)}`),this.frameIndex++},100)}stop(n=!0,e){if(!this.isActive)return;if(this.isActive=!1,this.interval)clearInterval(this.interval),this.interval=null;if(process.stdout.write(`\r${" ".repeat(80)}\r`),e)m(e,n?"success":"warning")}}async function I(n){x("\uD83D\uDCDD \u74B0\u5883\u8A2D\u5B9A");let e=tn(n,".env.example"),t=tn(n,".env");if(en(t)){p("",".env\u30D5\u30A1\u30A4\u30EB\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");return}if(en(e))p("\uD83D\uDCDD",".env.example\u304B\u3089.env\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u3066\u3044\u307E\u3059...","info"),Vn(e,t),p("",".env\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u307E\u3057\u305F","success");else p("\u26A0\uFE0F",".env.example\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002\u7A7A\u306E.env\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u307E\u3059...","warning"),Fn(t,`# Environment variables
`),p("","\u7A7A\u306E.env\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u307E\u3057\u305F","success")}var g;var w=Cn(()=>{g=W(T(),1)});import{EventEmitter as kn}from"events";function S(n){return n==null?[]:Array.isArray(n)?n:[n]}function En(n,e,t,s){var i,o=n[e],l=~s.string.indexOf(e)?t==null||t===!0?"":String(t):typeof t==="boolean"?t:~s.boolean.indexOf(e)?t==="false"?!1:t==="true"||(n._.push((i=+t,i*0===0)?i:t),!!t):(i=+t,i*0===0)?i:t;n[e]=o==null?l:Array.isArray(o)?o.concat(l):[o,l]}function $n(n,e){n=n||[],e=e||{};var t,s,i,o,l,c={_:[]},r=0,a=0,f=0,h=n.length;let v=e.alias!==void 0,$=e.unknown!==void 0,B=e.default!==void 0;if(e.alias=e.alias||{},e.string=S(e.string),e.boolean=S(e.boolean),v)for(t in e.alias){s=e.alias[t]=S(e.alias[t]);for(r=0;r<s.length;r++)(e.alias[s[r]]=s.concat(t)).splice(r,1)}for(r=e.boolean.length;r-- >0;){s=e.alias[e.boolean[r]]||[];for(a=s.length;a-- >0;)e.boolean.push(s[a])}for(r=e.string.length;r-- >0;){s=e.alias[e.string[r]]||[];for(a=s.length;a-- >0;)e.string.push(s[a])}if(B){for(t in e.default)if(o=typeof e.default[t],s=e.alias[t]=e.alias[t]||[],e[o]!==void 0){e[o].push(t);for(r=0;r<s.length;r++)e[o].push(s[r])}}let Q=$?Object.keys(e.alias):[];for(r=0;r<h;r++){if(i=n[r],i==="--"){c._=c._.concat(n.slice(++r));break}for(a=0;a<i.length;a++)if(i.charCodeAt(a)!==45)break;if(a===0)c._.push(i);else if(i.substring(a,a+3)==="no-"){if(o=i.substring(a+3),$&&!~Q.indexOf(o))return e.unknown(i);c[o]=!1}else{for(f=a+1;f<i.length;f++)if(i.charCodeAt(f)===61)break;o=i.substring(a,f),l=i.substring(++f)||(r+1===h||(""+n[r+1]).charCodeAt(0)===45||n[++r]),s=a===2?[o]:o;for(f=0;f<s.length;f++){if(o=s[f],$&&!~Q.indexOf(o))return e.unknown("-".repeat(a)+o);En(c,o,f+1<s.length||l,e)}}}if(B){for(t in e.default)if(c[t]===void 0)c[t]=e.default[t]}if(v)for(t in c){s=e.alias[t]||[];while(s.length>0)c[s.shift()]=c[t]}return c}var J=(n)=>n.replace(/[<[].+/,"").trim(),An=(n)=>{let e=/<([^>]+)>/g,t=/\[([^\]]+)\]/g,s=[],i=(c)=>{let r=!1,a=c[1];if(a.startsWith("..."))a=a.slice(3),r=!0;return{required:c[0].startsWith("<"),value:a,variadic:r}},o;while(o=e.exec(n))s.push(i(o));let l;while(l=t.exec(n))s.push(i(l));return s},Sn=(n)=>{let e={alias:{},boolean:[]};for(let[t,s]of n.entries()){if(s.names.length>1)e.alias[s.names[0]]=s.names.slice(1);if(s.isBoolean)if(s.negated){if(!n.some((o,l)=>{return l!==t&&o.names.some((c)=>s.names.includes(c))&&typeof o.required==="boolean"}))e.boolean.push(s.names[0])}else e.boolean.push(s.names[0])}return e},K=(n)=>{return n.sort((e,t)=>{return e.length>t.length?-1:1})[0]},z=(n,e)=>{return n.length>=e?n:`${n}${" ".repeat(e-n.length)}`},Mn=(n)=>{return n.replace(/([a-z])-([a-z])/g,(e,t,s)=>{return t+s.toUpperCase()})},_n=(n,e,t)=>{let s=0,i=e.length,o=n,l;for(;s<i;++s)l=o[e[s]],o=o[e[s]]=s===i-1?t:l!=null?l:!!~e[s+1].indexOf(".")||!(+e[s+1]>-1)?{}:[]},Rn=(n,e)=>{for(let t of Object.keys(e)){let s=e[t];if(s.shouldTransform){if(n[t]=Array.prototype.concat.call([],n[t]),typeof s.transformFunction==="function")n[t]=n[t].map(s.transformFunction)}}},Tn=(n)=>{let e=/([^\\\/]+)$/.exec(n);return e?e[1]:""},N=(n)=>{return n.split(".").map((e,t)=>{return t===0?Mn(e):e}).join(".")};class C extends Error{constructor(n){super(n);if(this.name=this.constructor.name,typeof Error.captureStackTrace==="function")Error.captureStackTrace(this,this.constructor);else this.stack=new Error(n).stack}}class X{constructor(n,e,t){if(this.rawName=n,this.description=e,this.config=Object.assign({},t),n=n.replace(/\.\*/g,""),this.negated=!1,this.names=J(n).split(",").map((s)=>{let i=s.trim().replace(/^-{1,2}/,"");if(i.startsWith("no-"))this.negated=!0,i=i.replace(/^no-/,"");return N(i)}).sort((s,i)=>s.length>i.length?1:-1),this.name=this.names[this.names.length-1],this.negated&&this.config.default==null)this.config.default=!0;if(n.includes("<"))this.required=!0;else if(n.includes("["))this.required=!1;else this.isBoolean=!0}}var In=process.argv,jn=`${process.platform}-${process.arch} node-${process.version}`;class M{constructor(n,e,t={},s){this.rawName=n,this.description=e,this.config=t,this.cli=s,this.options=[],this.aliasNames=[],this.name=J(n),this.args=An(n),this.examples=[]}usage(n){return this.usageText=n,this}allowUnknownOptions(){return this.config.allowUnknownOptions=!0,this}ignoreOptionDefaultValue(){return this.config.ignoreOptionDefaultValue=!0,this}version(n,e="-v, --version"){return this.versionNumber=n,this.option(e,"Display version number"),this}example(n){return this.examples.push(n),this}option(n,e,t){let s=new X(n,e,t);return this.options.push(s),this}alias(n){return this.aliasNames.push(n),this}action(n){return this.commandAction=n,this}isMatched(n){return this.name===n||this.aliasNames.includes(n)}get isDefaultCommand(){return this.name===""||this.aliasNames.includes("!")}get isGlobalCommand(){return this instanceof _}hasOption(n){return n=n.split(".")[0],this.options.find((e)=>{return e.names.includes(n)})}outputHelp(){let{name:n,commands:e}=this.cli,{versionNumber:t,options:s,helpCallback:i}=this.cli.globalCommand,o=[{body:`${n}${t?`/${t}`:""}`}];if(o.push({title:"Usage",body:`  $ ${n} ${this.usageText||this.rawName}`}),(this.isGlobalCommand||this.isDefaultCommand)&&e.length>0){let r=K(e.map((a)=>a.rawName));o.push({title:"Commands",body:e.map((a)=>{return`  ${z(a.rawName,r.length)}  ${a.description}`}).join(`
`)}),o.push({title:"For more info, run any command with the `--help` flag",body:e.map((a)=>`  $ ${n}${a.name===""?"":` ${a.name}`} --help`).join(`
`)})}let c=this.isGlobalCommand?s:[...this.options,...s||[]];if(!this.isGlobalCommand&&!this.isDefaultCommand)c=c.filter((r)=>r.name!=="version");if(c.length>0){let r=K(c.map((a)=>a.rawName));o.push({title:"Options",body:c.map((a)=>{return`  ${z(a.rawName,r.length)}  ${a.description} ${a.config.default===void 0?"":`(default: ${a.config.default})`}`}).join(`
`)})}if(this.examples.length>0)o.push({title:"Examples",body:this.examples.map((r)=>{if(typeof r==="function")return r(n);return r}).join(`
`)});if(i)o=i(o)||o;console.log(o.map((r)=>{return r.title?`${r.title}:
${r.body}`:r.body}).join(`

`))}outputVersion(){let{name:n}=this.cli,{versionNumber:e}=this.cli.globalCommand;if(e)console.log(`${n}/${e} ${jn}`)}checkRequiredArgs(){let n=this.args.filter((e)=>e.required).length;if(this.cli.args.length<n)throw new C(`missing required args for command \`${this.rawName}\``)}checkUnknownOptions(){let{options:n,globalCommand:e}=this.cli;if(!this.config.allowUnknownOptions){for(let t of Object.keys(n))if(t!=="--"&&!this.hasOption(t)&&!e.hasOption(t))throw new C(`Unknown option \`${t.length>1?`--${t}`:`-${t}`}\``)}}checkOptionValue(){let{options:n,globalCommand:e}=this.cli,t=[...e.options,...this.options];for(let s of t){let i=n[s.name.split(".")[0]];if(s.required){let o=t.some((l)=>l.negated&&l.names.includes(s.name));if(i===!0||i===!1&&!o)throw new C(`option \`${s.rawName}\` value is missing`)}}}}class _ extends M{constructor(n){super("@@global@@","",{},n)}}var O=Object.assign;class Z extends kn{constructor(n=""){super();this.name=n,this.commands=[],this.rawArgs=[],this.args=[],this.options={},this.globalCommand=new _(this),this.globalCommand.usage("<command> [options]")}usage(n){return this.globalCommand.usage(n),this}command(n,e,t){let s=new M(n,e||"",t,this);return s.globalCommand=this.globalCommand,this.commands.push(s),s}option(n,e,t){return this.globalCommand.option(n,e,t),this}help(n){return this.globalCommand.option("-h, --help","Display this message"),this.globalCommand.helpCallback=n,this.showHelpOnExit=!0,this}version(n,e="-v, --version"){return this.globalCommand.version(n,e),this.showVersionOnExit=!0,this}example(n){return this.globalCommand.example(n),this}outputHelp(){if(this.matchedCommand)this.matchedCommand.outputHelp();else this.globalCommand.outputHelp()}outputVersion(){this.globalCommand.outputVersion()}setParsedInfo({args:n,options:e},t,s){if(this.args=n,this.options=e,t)this.matchedCommand=t;if(s)this.matchedCommandName=s;return this}unsetMatchedCommand(){this.matchedCommand=void 0,this.matchedCommandName=void 0}parse(n=In,{run:e=!0}={}){if(this.rawArgs=n,!this.name)this.name=n[1]?Tn(n[1]):"cli";let t=!0;for(let i of this.commands){let o=this.mri(n.slice(2),i),l=o.args[0];if(i.isMatched(l)){t=!1;let c=O(O({},o),{args:o.args.slice(1)});this.setParsedInfo(c,i,l),this.emit(`command:${l}`,i)}}if(t){for(let i of this.commands)if(i.name===""){t=!1;let o=this.mri(n.slice(2),i);this.setParsedInfo(o,i),this.emit("command:!",i)}}if(t){let i=this.mri(n.slice(2));this.setParsedInfo(i)}if(this.options.help&&this.showHelpOnExit)this.outputHelp(),e=!1,this.unsetMatchedCommand();if(this.options.version&&this.showVersionOnExit&&this.matchedCommandName==null)this.outputVersion(),e=!1,this.unsetMatchedCommand();let s={args:this.args,options:this.options};if(e)this.runMatchedCommand();if(!this.matchedCommand&&this.args[0])this.emit("command:*");return s}mri(n,e){let t=[...this.globalCommand.options,...e?e.options:[]],s=Sn(t),i=[],o=n.indexOf("--");if(o>-1)i=n.slice(o+1),n=n.slice(0,o);let l=$n(n,s);l=Object.keys(l).reduce((h,v)=>{return O(O({},h),{[N(v)]:l[v]})},{_:[]});let c=l._,r={"--":i},a=e&&e.config.ignoreOptionDefaultValue?e.config.ignoreOptionDefaultValue:this.globalCommand.config.ignoreOptionDefaultValue,f=Object.create(null);for(let h of t){if(!a&&h.config.default!==void 0)for(let v of h.names)r[v]=h.config.default;if(Array.isArray(h.config.type)){if(f[h.name]===void 0)f[h.name]=Object.create(null),f[h.name].shouldTransform=!0,f[h.name].transformFunction=h.config.type[0]}}for(let h of Object.keys(l))if(h!=="_"){let v=h.split(".");_n(r,v,l[h]),Rn(r,f)}return{args:c,options:r}}runMatchedCommand(){let{args:n,options:e,matchedCommand:t}=this;if(!t||!t.commandAction)return;t.checkUnknownOptions(),t.checkOptionValue(),t.checkRequiredArgs();let s=[];return t.args.forEach((i,o)=>{if(i.variadic)s.push(n.slice(o));else s.push(n[o])}),s.push(e),t.commandAction.apply(this,s)}}var L=(n="")=>new Z(n);var u=W(T(),1);var{$:pn}=globalThis.Bun;import{existsSync as gn}from"fs";import{join as dn,resolve as Y}from"path";w();var{$:b}=globalThis.Bun;import{existsSync as on}from"fs";import{join as P}from"path";async function Gn(){try{return await b`docker --version`.quiet(),!0}catch{return!1}}async function Yn(n){try{return(await b`docker ps -a --filter name=^${n}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===n}catch{return!1}}async function Hn(n){try{return(await b`docker ps --filter name=^${n}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===n}catch{return!1}}async function rn(n){try{return(await b`docker images --format {{.Repository}}:{{.Tag}}`.quiet()).stdout.toString().trim().split(`
`).some((s)=>s.startsWith(`${n}:`)||s===n)}catch{return!1}}async function Bn(n,e,t){let s=new d("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059");s.start();try{await b`docker build -t db -f ${e} ${t}`.cwd(n).quiet(),s.stop(!0,"MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(i){throw s.stop(!1,"MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),i}}async function Qn(n,e,t){m("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059...","info");try{await b`docker build -t db -f ${e} ${t}`.cwd(n).quiet(),m("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(s){throw m("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),s}}async function Wn(n,e){let t=new d("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059");t.start();try{await b`docker build -t e2e -f ${e} .`.cwd(n).quiet(),t.stop(!0,"E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(s){throw t.stop(!1,"E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),s}}async function Kn(n,e){m("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059...","info");try{await b`docker build -t e2e -f ${e} .`.cwd(n).quiet(),m("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(t){throw m("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),t}}async function zn(n,e){try{return(await b`docker exec -e MYSQL_PWD=${e} ${n} mysqladmin ping -h localhost -u root`.quiet()).exitCode===0}catch{return!1}}function j(n,e,t){if(n)n.stop(e,t);else m(t,e?"success":"warning")}async function Jn(n,e,t){for(let s=0;s<t;s++){if(await zn(n,e))return!0;await new Promise((o)=>setTimeout(o,1000))}return!1}async function q(n,e=!0,t=30){let s=process.env.MYSQL_ROOT_PASSWORD||"rootpassword",i=e?new d("MySQL\u306E\u8D77\u52D5\u3092\u5F85\u6A5F\u3057\u3066\u3044\u307E\u3059"):null;if(i)i.start();try{if(await Jn(n,s,t))return j(i,!0,"MySQL\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F"),!0;return j(i,!1,"MySQL\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F"),!1}catch{return j(i,!1,"MySQL\u306E\u8D77\u52D5\u78BA\u8A8D\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),!1}}async function Nn(n,e,t){if(await Hn(n)){m("MySQL\u30B3\u30F3\u30C6\u30CA\u306F\u65E2\u306B\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059","success"),await q(n,t);return}m("MySQL\u30B3\u30F3\u30C6\u30CA\u3092\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info"),await b`docker start ${n}`.cwd(e).quiet(),await q(n,t)}async function Xn(n,e,t){m("MySQL\u30B3\u30F3\u30C6\u30CA\u3092\u4F5C\u6210\u3057\u3066\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info");let s=process.env.MYSQL_ROOT_PASSWORD||"rootpassword",i=process.env.MYSQL_DATABASE||"portfolio",o=process.env.MYSQL_USER||"user",l=process.env.MYSQL_PASSWORD||"password";if(await b`docker run -d \
        --name ${n} \
        -p 3306:3306 \
        -e MYSQL_ROOT_PASSWORD=${s} \
        -e MYSQL_DATABASE=${i} \
        -e MYSQL_USER=${o} \
        -e MYSQL_PASSWORD=${l} \
        -v db-data:/var/lib/mysql \
        db`.cwd(e).quiet(),m("MySQL\u30B3\u30F3\u30C6\u30CA\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F","success"),!await q(n,t))m("MySQL\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F","warning")}async function Zn(n,e=!0){let s=P(n,".docker/db"),i=P(s,"Dockerfile");if(!on(i)){m("MySQL Dockerfile\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093","warning");return}try{if(!await Gn()){m("Docker\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093","warning");return}if(await rn("db"))m("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");else if(e)await Bn(n,i,s);else await Qn(n,i,s);if(await Yn("db")){await Nn("db",n,e);return}await Xn("db",n,e)}catch(o){if(m("MySQL\u30B3\u30F3\u30C6\u30CA\u306E\u8D77\u52D5\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),process.env.DEBUG)console.error(o)}}async function U(n,e=!0){x("\uD83D\uDC33 Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9");let t=P(n,".docker/e2e/Dockerfile");if(on(t))try{if(await rn("e2e"))m("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");else if(e)await Wn(n,t);else await Kn(n,t)}catch(s){if(m("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),process.env.DEBUG)console.error(s)}await Zn(n,e)}w();w();var{$:Ln}=globalThis.Bun;async function an(n){x("\uD83D\uDCE6 \u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB");let e=new d("\u4F9D\u5B58\u95A2\u4FC2\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059");e.start();try{await Ln`bun install --ignore-scripts`.cwd(n).quiet(),e.stop(!0,"\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(t){if(e.stop(!1,"\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),process.env.DEBUG)console.error(t);throw t}}w();var{$:F}=globalThis.Bun;import{existsSync as Dn,readFileSync as ne,writeFileSync as ln}from"fs";import{join as V}from"path";var ee=/Error:\s*([^\n]+)/,te=/Duplicate key name/i,se=[te];async function ie(n){try{return(await F`docker ps --filter name=^${n}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===n}catch{return!1}}function oe(n){let e=n,t=e?.stderr?.toString()??e?.message??String(n);return ee.exec(t)?.[1]?.trim()??null}function re(n){return n.length>80?`${n.substring(0,77)}...`:n}function ae(n){let e=n,t=e?.stderr?.toString()??e?.stdout?.toString()??e?.message??String(n);return se.some((s)=>s.test(t))}function cn(n,e){if(ae(n))e.stop(!0,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F\uFF08\u4E00\u90E8\u306E\u8B66\u544A\u3042\u308A\uFF09");else e.stop(!1,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u306B\u5931\u6557\u3057\u307E\u3057\u305F");if(process.env.DEBUG){console.error(n);return}let s=oe(n);if(s)m(re(s),"warning")}function le(){let n=process.env.MYSQL_USER||"user",e=process.env.MYSQL_PASSWORD||"password",t=process.env.MYSQL_DATABASE||"portfolio",s=process.env.MYSQL_HOST||"localhost",i=process.env.MYSQL_PORT||"3306";return`mysql://${n}:${e}@${s}:${i}/${t}`}async function ce(n){let e=new d("\u30ED\u30FC\u30AB\u30EBMySQL\u306B\u5BFE\u3057\u3066\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u3092\u5B9F\u884C\u3057\u3066\u3044\u307E\u3059");e.start();let t=V(n,"packages/db"),s=V(t,"prisma/schema/schema.prisma");if(!Dn(s)){e.stop(!1,"\u30B9\u30AD\u30FC\u30DE\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");return}let i=le(),o=ne(s,"utf-8"),l=o.replace(/provider\s*=\s*"sqlite"/,'provider = "mysql"');ln(s,l);try{await F`DATABASE_URL=${i} bun run push`.cwd(t).quiet(),e.stop(!0,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(c){cn(c,e)}finally{ln(s,o)}}async function me(n){let e=new d("Cloudflare D1\u306B\u5BFE\u3057\u3066\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u3092\u5B9F\u884C\u3057\u3066\u3044\u307E\u3059");e.start();let t=V(n,"packages/db");try{await F`bun run migrate`.cwd(t).quiet(),e.stop(!0,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(s){cn(s,e)}}async function mn(n){if(x("\uD83D\uDD04 \u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3"),await ie("db"))await ce(n);else await me(n)}w();var{$:un}=globalThis.Bun;import{join as hn}from"path";var ue=/Error:\s*([^\n]+)/;async function G(n,e=!0){if(x("\uD83D\uDDC4\uFE0F  Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210"),e){let t=new d("Prisma\u30B9\u30AD\u30FC\u30DE\u3092\u751F\u6210\u3057\u3066\u3044\u307E\u3059");t.start();try{await un`bun run generate`.cwd(hn(n,"packages/db")).quiet(),t.stop(!0,"Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(s){t.stop(!1,"Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),fn(s)}}else{p("\uD83D\uDDC4\uFE0F","Prisma\u30B9\u30AD\u30FC\u30DE\u3092\u751F\u6210\u3057\u3066\u3044\u307E\u3059...","info");try{await un`bun run generate`.cwd(hn(n,"packages/db")).quiet(),p("","Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(t){p("","Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),fn(t)}}}function fn(n){if(process.env.DEBUG){console.error(n);return}let e=n,t=e?.stderr?.toString()??e?.message??String(n),s=ue.exec(t);if(s?.[1]){let i=s[1].trim(),o=i.length>80?`${i.substring(0,77)}...`:i;m(o,"warning")}}function he(n=process.cwd()){let e=Y(n),t=Y("/");while(e!==t){let s=dn(e,"package.json"),i=dn(e,"turbo.json");if(gn(s)&&gn(i))return e;e=Y(e,"..")}return process.cwd()}async function fe(){if(process.versions?.bun!==void 0)return!0;try{if(pn!==void 0)return await pn`bun --version`.quiet(),!0}catch{return!1}return!1}function pe(n){return!n.env&&!n.install&&!n.schema&&!n.docker&&!n.migrate}function ge(n){let e=pe(n);return{runEnv:e||n.env!==!1,runInstall:e||n.install!==!1,runSchema:e||n.schema!==!1,runDocker:e||n.docker!==!1,runMigrate:e||n.migrate!==!1,parallel:n.parallel??!0}}function de(){console.log(),console.log(u.default.bold(u.default.cyan("  \u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E"))),console.log(u.default.bold(u.default.cyan("  \u2502  \uD83D\uDE80 \u958B\u767A\u74B0\u5883\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3092\u958B\u59CB\u3057\u307E\u3059      \u2502"))),console.log(u.default.bold(u.default.cyan("  \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F")))}function be(){console.log(),console.log(u.default.bold(u.default.green("  \u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E"))),console.log(u.default.bold(u.default.green("  \u2502  \u2705 \u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F\uFF01            \u2502"))),console.log(u.default.bold(u.default.green("  \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F"))),console.log(),console.log(u.default.bold("  \u6B21\u306E\u30B9\u30C6\u30C3\u30D7:")),console.log(u.default.dim("    \u2022 .env\u30D5\u30A1\u30A4\u30EB\u3092\u7DE8\u96C6\u3057\u3066\u74B0\u5883\u5909\u6570\u3092\u8A2D\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044")),console.log(u.default.dim("    \u2022 bun run dev \u3067\u958B\u767A\u30B5\u30FC\u30D0\u30FC\u3092\u8D77\u52D5\u3067\u304D\u307E\u3059")),console.log()}function xe(n){console.log(),console.error(u.default.bold(u.default.red("  \u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E"))),console.error(u.default.bold(u.default.red("  \u2502  \u2717 \u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F    \u2502"))),console.error(u.default.bold(u.default.red("  \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F"))),console.error(),console.error(u.default.red("  "),n),console.error()}async function ve(n,e){if(!e)return;if(process.env.BUN_LIFECYCLE_EVENT==="prepare"){let{logSection:s}=await Promise.resolve().then(() => (w(),sn));s("\uD83D\uDCE6 \u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB"),p("","\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3092\u30B9\u30AD\u30C3\u30D7\u3057\u307E\u3057\u305F\uFF08prepare\u30B9\u30AF\u30EA\u30D7\u30C8\u304B\u3089\u5B9F\u884C\u4E2D\uFF09","info");return}await an(n)}async function we(n,e,t,s){let i=!s;if(s&&(e||t)){let o=[];if(e)o.push(G(n,i));if(t)o.push(U(n,i));await Promise.all(o);return}if(e)await G(n,i);if(t)await U(n,i)}async function H(n={}){let e=he(),t=ge(n);if(de(),!await fe())console.log(),console.error(u.default.red("  \u2717 Bun\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093\u3002")),console.error(u.default.dim("    Bun\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u304F\u3060\u3055\u3044: https://bun.sh")),process.exit(1);p("","Bun\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u3059","success");try{if(t.runEnv)await I(e);if(await ve(e,t.runInstall),await we(e,t.runSchema,t.runDocker,t.parallel),t.runMigrate)await mn(e);be()}catch(i){xe(i),process.exit(1)}}var y=L("workspace");y.command("setup","\u958B\u767A\u74B0\u5883\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3092\u5B9F\u884C\u3057\u307E\u3059").option("--env","\u74B0\u5883\u8A2D\u5B9A\u306E\u307F\u5B9F\u884C").option("--install","\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306E\u307F\u5B9F\u884C").option("--schema","Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u306E\u307F\u5B9F\u884C").option("--docker","Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306E\u307F\u5B9F\u884C").option("--migrate","\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u306E\u307F\u5B9F\u884C").option("--no-parallel","\u4E26\u5217\u5B9F\u884C\u3092\u7121\u52B9\u5316").action(async(n)=>{let e={env:n.env!==void 0,install:n.install!==void 0,schema:n.schema!==void 0,docker:n.docker!==void 0,migrate:n.migrate!==void 0,parallel:!n["no-parallel"]};await H(e)});y.command("*","\u958B\u767A\u74B0\u5883\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3092\u5B9F\u884C\u3057\u307E\u3059").action(async()=>{await H()});y.help();y.version("1.0.1");y.parse();
