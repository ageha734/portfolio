#!/usr/bin/env bun
// @bun
var yn=Object.create;var{getPrototypeOf:On,defineProperty:M,getOwnPropertyNames:Sn}=Object;var Cn=Object.prototype.hasOwnProperty;var X=(n,t,e)=>{e=n!=null?yn(On(n)):{};let s=t||!n||!n.__esModule?M(e,"default",{value:n,enumerable:!0}):e;for(let i of Sn(n))if(!Cn.call(s,i))M(s,i,{get:()=>n[i],enumerable:!0});return s};var En=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var kn=(n,t)=>{for(var e in t)M(n,e,{get:t[e],enumerable:!0,configurable:!0,set:(s)=>t[e]=()=>s})};var $n=(n,t)=>()=>(n&&(t=n(n=0)),t);var j=En((Tt,I)=>{var $=process||{},en=$.argv||[],k=$.env||{},Gn=!(!!k.NO_COLOR||en.includes("--no-color"))&&(!!k.FORCE_COLOR||en.includes("--color")||$.platform==="win32"||($.stdout||{}).isTTY&&k.TERM!=="dumb"||!!k.CI),Yn=(n,t,e=n)=>(s)=>{let i=""+s,o=i.indexOf(t,n.length);return~o?n+Hn(i,t,e,o)+t:n+i+t},Hn=(n,t,e,s)=>{let i="",o=0;do i+=n.substring(o,s)+e,o=s+t.length,s=n.indexOf(t,o);while(~s);return i+n.substring(o)},sn=(n=Gn)=>{let t=n?Yn:()=>String;return{isColorSupported:n,reset:t("\x1B[0m","\x1B[0m"),bold:t("\x1B[1m","\x1B[22m","\x1B[22m\x1B[1m"),dim:t("\x1B[2m","\x1B[22m","\x1B[22m\x1B[2m"),italic:t("\x1B[3m","\x1B[23m"),underline:t("\x1B[4m","\x1B[24m"),inverse:t("\x1B[7m","\x1B[27m"),hidden:t("\x1B[8m","\x1B[28m"),strikethrough:t("\x1B[9m","\x1B[29m"),black:t("\x1B[30m","\x1B[39m"),red:t("\x1B[31m","\x1B[39m"),green:t("\x1B[32m","\x1B[39m"),yellow:t("\x1B[33m","\x1B[39m"),blue:t("\x1B[34m","\x1B[39m"),magenta:t("\x1B[35m","\x1B[39m"),cyan:t("\x1B[36m","\x1B[39m"),white:t("\x1B[37m","\x1B[39m"),gray:t("\x1B[90m","\x1B[39m"),bgBlack:t("\x1B[40m","\x1B[49m"),bgRed:t("\x1B[41m","\x1B[49m"),bgGreen:t("\x1B[42m","\x1B[49m"),bgYellow:t("\x1B[43m","\x1B[49m"),bgBlue:t("\x1B[44m","\x1B[49m"),bgMagenta:t("\x1B[45m","\x1B[49m"),bgCyan:t("\x1B[46m","\x1B[49m"),bgWhite:t("\x1B[47m","\x1B[49m"),blackBright:t("\x1B[90m","\x1B[39m"),redBright:t("\x1B[91m","\x1B[39m"),greenBright:t("\x1B[92m","\x1B[39m"),yellowBright:t("\x1B[93m","\x1B[39m"),blueBright:t("\x1B[94m","\x1B[39m"),magentaBright:t("\x1B[95m","\x1B[39m"),cyanBright:t("\x1B[96m","\x1B[39m"),whiteBright:t("\x1B[97m","\x1B[39m"),bgBlackBright:t("\x1B[100m","\x1B[49m"),bgRedBright:t("\x1B[101m","\x1B[49m"),bgGreenBright:t("\x1B[102m","\x1B[49m"),bgYellowBright:t("\x1B[103m","\x1B[49m"),bgBlueBright:t("\x1B[104m","\x1B[49m"),bgMagentaBright:t("\x1B[105m","\x1B[49m"),bgCyanBright:t("\x1B[106m","\x1B[49m"),bgWhiteBright:t("\x1B[107m","\x1B[49m")}};I.exports=sn();I.exports.createColors=sn});var ln={};kn(ln,{setupEnvFile:()=>q,logSubStep:()=>c,logStep:()=>b,logSection:()=>x,LoadingBar:()=>g});import{copyFileSync as Pn,existsSync as on,writeFileSync as Qn}from"fs";import{join as rn}from"path";function x(n){console.log(),console.log(d.default.bold(d.default.cyan(`  ${n}`))),console.log(d.default.dim(`  ${"\u2500".repeat(50)}`))}function b(n,t,e="info"){let s={info:d.default.blue,success:d.default.green,warning:d.default.yellow,error:d.default.red},i;if(e==="success")i="\u2713";else if(e==="error")i="\u2717";else if(e==="warning")i="\u26A0";else i="\u2192";console.log(`  ${s[e](i)} ${n} ${t}`)}function c(n,t="info"){let e={info:d.default.dim,success:d.default.green,warning:d.default.yellow},s;if(t==="success")s="\u2713";else if(t==="warning")s="\u26A0";else s="  ";console.log(`    ${e[t](s)} ${n}`)}class g{message;interval=null;frames=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"];frameIndex=0;isActive=!1;constructor(n){this.message=n}start(){if(this.isActive)return;this.isActive=!0,this.frameIndex=0,this.interval=setInterval(()=>{let n=this.frames[this.frameIndex%this.frames.length];process.stdout.write(`\r    ${d.default.cyan(n)} ${d.default.dim(this.message)}`),this.frameIndex++},100)}stop(n=!0,t){if(!this.isActive)return;if(this.isActive=!1,this.interval)clearInterval(this.interval),this.interval=null;if(process.stdout.write(`\r${" ".repeat(80)}\r`),t)c(t,n?"success":"warning")}}async function q(n){x("\uD83D\uDCDD \u74B0\u5883\u8A2D\u5B9A");let t=rn(n,".env.example"),e=rn(n,".env");if(on(e)){b("",".env\u30D5\u30A1\u30A4\u30EB\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");return}if(on(t))b("\uD83D\uDCDD",".env.example\u304B\u3089.env\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u3066\u3044\u307E\u3059...","info"),Pn(t,e),b("",".env\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u307E\u3057\u305F","success");else b("\u26A0\uFE0F",".env.example\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002\u7A7A\u306E.env\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u307E\u3059...","warning"),Qn(e,`# Environment variables
`),b("","\u7A7A\u306E.env\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u307E\u3057\u305F","success")}var d;var w=$n(()=>{d=X(j(),1)});import{EventEmitter as An}from"events";function _(n){return n==null?[]:Array.isArray(n)?n:[n]}function Mn(n,t,e,s){var i,o=n[t],a=~s.string.indexOf(t)?e==null||e===!0?"":String(e):typeof e==="boolean"?e:~s.boolean.indexOf(t)?e==="false"?!1:e==="true"||(n._.push((i=+e,i*0===0)?i:e),!!e):(i=+e,i*0===0)?i:e;n[t]=o==null?a:Array.isArray(o)?o.concat(a):[o,a]}function _n(n,t){n=n||[],t=t||{};var e,s,i,o,a,u={_:[]},r=0,l=0,f=0,h=n.length;let v=t.alias!==void 0,A=t.unknown!==void 0,z=t.default!==void 0;if(t.alias=t.alias||{},t.string=_(t.string),t.boolean=_(t.boolean),v)for(e in t.alias){s=t.alias[e]=_(t.alias[e]);for(r=0;r<s.length;r++)(t.alias[s[r]]=s.concat(e)).splice(r,1)}for(r=t.boolean.length;r-- >0;){s=t.alias[t.boolean[r]]||[];for(l=s.length;l-- >0;)t.boolean.push(s[l])}for(r=t.string.length;r-- >0;){s=t.alias[t.string[r]]||[];for(l=s.length;l-- >0;)t.string.push(s[l])}if(z){for(e in t.default)if(o=typeof t.default[e],s=t.alias[e]=t.alias[e]||[],t[o]!==void 0){t[o].push(e);for(r=0;r<s.length;r++)t[o].push(s[r])}}let J=A?Object.keys(t.alias):[];for(r=0;r<h;r++){if(i=n[r],i==="--"){u._=u._.concat(n.slice(++r));break}for(l=0;l<i.length;l++)if(i.charCodeAt(l)!==45)break;if(l===0)u._.push(i);else if(i.substring(l,l+3)==="no-"){if(o=i.substring(l+3),A&&!~J.indexOf(o))return t.unknown(i);u[o]=!1}else{for(f=l+1;f<i.length;f++)if(i.charCodeAt(f)===61)break;o=i.substring(l,f),a=i.substring(++f)||(r+1===h||(""+n[r+1]).charCodeAt(0)===45||n[++r]),s=l===2?[o]:o;for(f=0;f<s.length;f++){if(o=s[f],A&&!~J.indexOf(o))return t.unknown("-".repeat(l)+o);Mn(u,o,f+1<s.length||a,t)}}}if(z){for(e in t.default)if(u[e]===void 0)u[e]=t.default[e]}if(v)for(e in u){s=t.alias[e]||[];while(s.length>0)u[s.shift()]=u[e]}return u}var B=(n)=>n.replace(/[<[].+/,"").trim(),Rn=(n)=>{let t=/<([^>]+)>/g,e=/\[([^\]]+)\]/g,s=[],i=(u)=>{let r=!1,l=u[1];if(l.startsWith("..."))l=l.slice(3),r=!0;return{required:u[0].startsWith("<"),value:l,variadic:r}},o;while(o=t.exec(n))s.push(i(o));let a;while(a=e.exec(n))s.push(i(a));return s},Tn=(n)=>{let t={alias:{},boolean:[]};for(let[e,s]of n.entries()){if(s.names.length>1)t.alias[s.names[0]]=s.names.slice(1);if(s.isBoolean)if(s.negated){if(!n.some((o,a)=>{return a!==e&&o.names.some((u)=>s.names.includes(u))&&typeof o.required==="boolean"}))t.boolean.push(s.names[0])}else t.boolean.push(s.names[0])}return t},Z=(n)=>{return n.sort((t,e)=>{return t.length>e.length?-1:1})[0]},N=(n,t)=>{return n.length>=t?n:`${n}${" ".repeat(t-n.length)}`},In=(n)=>{return n.replace(/([a-z])-([a-z])/g,(t,e,s)=>{return e+s.toUpperCase()})},jn=(n,t,e)=>{let s=0,i=t.length,o=n,a;for(;s<i;++s)a=o[t[s]],o=o[t[s]]=s===i-1?e:a!=null?a:!!~t[s+1].indexOf(".")||!(+t[s+1]>-1)?{}:[]},qn=(n,t)=>{for(let e of Object.keys(t)){let s=t[e];if(s.shouldTransform){if(n[e]=Array.prototype.concat.call([],n[e]),typeof s.transformFunction==="function")n[e]=n[e].map(s.transformFunction)}}},Un=(n)=>{let t=/([^\\\/]+)$/.exec(n);return t?t[1]:""},L=(n)=>{return n.split(".").map((t,e)=>{return e===0?In(t):t}).join(".")};class E extends Error{constructor(n){super(n);if(this.name=this.constructor.name,typeof Error.captureStackTrace==="function")Error.captureStackTrace(this,this.constructor);else this.stack=new Error(n).stack}}class D{constructor(n,t,e){if(this.rawName=n,this.description=t,this.config=Object.assign({},e),n=n.replace(/\.\*/g,""),this.negated=!1,this.names=B(n).split(",").map((s)=>{let i=s.trim().replace(/^-{1,2}/,"");if(i.startsWith("no-"))this.negated=!0,i=i.replace(/^no-/,"");return L(i)}).sort((s,i)=>s.length>i.length?1:-1),this.name=this.names[this.names.length-1],this.negated&&this.config.default==null)this.config.default=!0;if(n.includes("<"))this.required=!0;else if(n.includes("["))this.required=!1;else this.isBoolean=!0}}var Vn=process.argv,Fn=`${process.platform}-${process.arch} node-${process.version}`;class R{constructor(n,t,e={},s){this.rawName=n,this.description=t,this.config=e,this.cli=s,this.options=[],this.aliasNames=[],this.name=B(n),this.args=Rn(n),this.examples=[]}usage(n){return this.usageText=n,this}allowUnknownOptions(){return this.config.allowUnknownOptions=!0,this}ignoreOptionDefaultValue(){return this.config.ignoreOptionDefaultValue=!0,this}version(n,t="-v, --version"){return this.versionNumber=n,this.option(t,"Display version number"),this}example(n){return this.examples.push(n),this}option(n,t,e){let s=new D(n,t,e);return this.options.push(s),this}alias(n){return this.aliasNames.push(n),this}action(n){return this.commandAction=n,this}isMatched(n){return this.name===n||this.aliasNames.includes(n)}get isDefaultCommand(){return this.name===""||this.aliasNames.includes("!")}get isGlobalCommand(){return this instanceof T}hasOption(n){return n=n.split(".")[0],this.options.find((t)=>{return t.names.includes(n)})}outputHelp(){let{name:n,commands:t}=this.cli,{versionNumber:e,options:s,helpCallback:i}=this.cli.globalCommand,o=[{body:`${n}${e?`/${e}`:""}`}];if(o.push({title:"Usage",body:`  $ ${n} ${this.usageText||this.rawName}`}),(this.isGlobalCommand||this.isDefaultCommand)&&t.length>0){let r=Z(t.map((l)=>l.rawName));o.push({title:"Commands",body:t.map((l)=>{return`  ${N(l.rawName,r.length)}  ${l.description}`}).join(`
`)}),o.push({title:"For more info, run any command with the `--help` flag",body:t.map((l)=>`  $ ${n}${l.name===""?"":` ${l.name}`} --help`).join(`
`)})}let u=this.isGlobalCommand?s:[...this.options,...s||[]];if(!this.isGlobalCommand&&!this.isDefaultCommand)u=u.filter((r)=>r.name!=="version");if(u.length>0){let r=Z(u.map((l)=>l.rawName));o.push({title:"Options",body:u.map((l)=>{return`  ${N(l.rawName,r.length)}  ${l.description} ${l.config.default===void 0?"":`(default: ${l.config.default})`}`}).join(`
`)})}if(this.examples.length>0)o.push({title:"Examples",body:this.examples.map((r)=>{if(typeof r==="function")return r(n);return r}).join(`
`)});if(i)o=i(o)||o;console.log(o.map((r)=>{return r.title?`${r.title}:
${r.body}`:r.body}).join(`

`))}outputVersion(){let{name:n}=this.cli,{versionNumber:t}=this.cli.globalCommand;if(t)console.log(`${n}/${t} ${Fn}`)}checkRequiredArgs(){let n=this.args.filter((t)=>t.required).length;if(this.cli.args.length<n)throw new E(`missing required args for command \`${this.rawName}\``)}checkUnknownOptions(){let{options:n,globalCommand:t}=this.cli;if(!this.config.allowUnknownOptions){for(let e of Object.keys(n))if(e!=="--"&&!this.hasOption(e)&&!t.hasOption(e))throw new E(`Unknown option \`${e.length>1?`--${e}`:`-${e}`}\``)}}checkOptionValue(){let{options:n,globalCommand:t}=this.cli,e=[...t.options,...this.options];for(let s of e){let i=n[s.name.split(".")[0]];if(s.required){let o=e.some((a)=>a.negated&&a.names.includes(s.name));if(i===!0||i===!1&&!o)throw new E(`option \`${s.rawName}\` value is missing`)}}}}class T extends R{constructor(n){super("@@global@@","",{},n)}}var C=Object.assign;class nn extends An{constructor(n=""){super();this.name=n,this.commands=[],this.rawArgs=[],this.args=[],this.options={},this.globalCommand=new T(this),this.globalCommand.usage("<command> [options]")}usage(n){return this.globalCommand.usage(n),this}command(n,t,e){let s=new R(n,t||"",e,this);return s.globalCommand=this.globalCommand,this.commands.push(s),s}option(n,t,e){return this.globalCommand.option(n,t,e),this}help(n){return this.globalCommand.option("-h, --help","Display this message"),this.globalCommand.helpCallback=n,this.showHelpOnExit=!0,this}version(n,t="-v, --version"){return this.globalCommand.version(n,t),this.showVersionOnExit=!0,this}example(n){return this.globalCommand.example(n),this}outputHelp(){if(this.matchedCommand)this.matchedCommand.outputHelp();else this.globalCommand.outputHelp()}outputVersion(){this.globalCommand.outputVersion()}setParsedInfo({args:n,options:t},e,s){if(this.args=n,this.options=t,e)this.matchedCommand=e;if(s)this.matchedCommandName=s;return this}unsetMatchedCommand(){this.matchedCommand=void 0,this.matchedCommandName=void 0}parse(n=Vn,{run:t=!0}={}){if(this.rawArgs=n,!this.name)this.name=n[1]?Un(n[1]):"cli";let e=!0;for(let i of this.commands){let o=this.mri(n.slice(2),i),a=o.args[0];if(i.isMatched(a)){e=!1;let u=C(C({},o),{args:o.args.slice(1)});this.setParsedInfo(u,i,a),this.emit(`command:${a}`,i)}}if(e){for(let i of this.commands)if(i.name===""){e=!1;let o=this.mri(n.slice(2),i);this.setParsedInfo(o,i),this.emit("command:!",i)}}if(e){let i=this.mri(n.slice(2));this.setParsedInfo(i)}if(this.options.help&&this.showHelpOnExit)this.outputHelp(),t=!1,this.unsetMatchedCommand();if(this.options.version&&this.showVersionOnExit&&this.matchedCommandName==null)this.outputVersion(),t=!1,this.unsetMatchedCommand();let s={args:this.args,options:this.options};if(t)this.runMatchedCommand();if(!this.matchedCommand&&this.args[0])this.emit("command:*");return s}mri(n,t){let e=[...this.globalCommand.options,...t?t.options:[]],s=Tn(e),i=[],o=n.indexOf("--");if(o>-1)i=n.slice(o+1),n=n.slice(0,o);let a=_n(n,s);a=Object.keys(a).reduce((h,v)=>{return C(C({},h),{[L(v)]:a[v]})},{_:[]});let u=a._,r={"--":i},l=t&&t.config.ignoreOptionDefaultValue?t.config.ignoreOptionDefaultValue:this.globalCommand.config.ignoreOptionDefaultValue,f=Object.create(null);for(let h of e){if(!l&&h.config.default!==void 0)for(let v of h.names)r[v]=h.config.default;if(Array.isArray(h.config.type)){if(f[h.name]===void 0)f[h.name]=Object.create(null),f[h.name].shouldTransform=!0,f[h.name].transformFunction=h.config.type[0]}}for(let h of Object.keys(a))if(h!=="_"){let v=h.split(".");jn(r,v,a[h]),qn(r,f)}return{args:u,options:r}}runMatchedCommand(){let{args:n,options:t,matchedCommand:e}=this;if(!e||!e.commandAction)return;e.checkUnknownOptions(),e.checkOptionValue(),e.checkRequiredArgs();let s=[];return e.args.forEach((i,o)=>{if(i.variadic)s.push(n.slice(o));else s.push(n[o])}),s.push(t),e.commandAction.apply(this,s)}}var tn=(n="")=>new nn(n);var m=X(j(),1);var{$:xn}=globalThis.Bun;import{existsSync as vn}from"fs";import{join as wn,resolve as W}from"path";w();var{$:p}=globalThis.Bun;import{existsSync as F}from"fs";import{join as O}from"path";async function cn(){try{return await p`docker --version`.quiet(),!0}catch{return!1}}async function an(n){try{return(await p`docker ps -a --filter name=^${n}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===n}catch{return!1}}async function un(n){try{return(await p`docker ps --filter name=^${n}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===n}catch{return!1}}async function G(n){try{return(await p`docker images --format {{.Repository}}:{{.Tag}}`.quiet()).stdout.toString().trim().split(`
`).some((s)=>s.startsWith(`${n}:`)||s===n)}catch{return!1}}async function Wn(n,t,e){let s=new g("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059");s.start();try{await p`docker build -t db -f ${t} ${e}`.cwd(n).quiet(),s.stop(!0,"MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(i){throw s.stop(!1,"MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),i}}async function Kn(n,t,e){c("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059...","info");try{await p`docker build -t db -f ${t} ${e}`.cwd(n).quiet(),c("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(s){throw c("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),s}}async function zn(n,t){let e=new g("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059");e.start();try{await p`docker build -t e2e -f ${t} .`.cwd(n).quiet(),e.stop(!0,"E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(s){throw e.stop(!1,"E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),s}}async function Jn(n,t){c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059...","info");try{await p`docker build -t e2e -f ${t} .`.cwd(n).quiet(),c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(e){throw c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),e}}async function Xn(n,t,e){let s=new g("Redis Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059");s.start();try{await p`docker build -t cache -f ${t} ${e}`.cwd(n).quiet(),s.stop(!0,"Redis Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(i){throw s.stop(!1,"Redis Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),i}}async function Zn(n,t,e){c("Redis Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059...","info");try{await p`docker build -t cache -f ${t} ${e}`.cwd(n).quiet(),c("Redis Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(s){throw c("Redis Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),s}}async function Nn(n,t){try{return(await p`docker exec -e MYSQL_PWD=${t} ${n} mysqladmin ping -h localhost -u root`.quiet()).exitCode===0}catch{return!1}}async function Bn(n,t){try{return(await p`docker exec ${n} redis-cli -a ${t} ping`.quiet()).stdout.toString().trim()==="PONG"}catch{return!1}}function y(n,t,e){if(n)n.stop(t,e);else c(e,t?"success":"warning")}async function Ln(n,t,e){for(let s=0;s<e;s++){if(await Nn(n,t))return!0;await new Promise((o)=>setTimeout(o,1000))}return!1}async function U(n,t=!0,e=30){let s=process.env.MYSQL_ROOT_PASSWORD||"rootpassword",i=t?new g("MySQL\u306E\u8D77\u52D5\u3092\u5F85\u6A5F\u3057\u3066\u3044\u307E\u3059"):null;if(i)i.start();try{if(await Ln(n,s,e))return y(i,!0,"MySQL\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F"),!0;return y(i,!1,"MySQL\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F"),!1}catch{return y(i,!1,"MySQL\u306E\u8D77\u52D5\u78BA\u8A8D\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),!1}}async function Dn(n,t,e){for(let s=0;s<e;s++){if(await Bn(n,t))return!0;await new Promise((o)=>setTimeout(o,1000))}return!1}async function V(n,t=!0,e=30){let s=process.env.REDIS_PASSWORD||"password",i=t?new g("Redis\u306E\u8D77\u52D5\u3092\u5F85\u6A5F\u3057\u3066\u3044\u307E\u3059"):null;if(i)i.start();try{if(await Dn(n,s,e))return y(i,!0,"Redis\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F"),!0;return y(i,!1,"Redis\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F"),!1}catch{return y(i,!1,"Redis\u306E\u8D77\u52D5\u78BA\u8A8D\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),!1}}async function nt(n,t,e){if(await un(n)){c("MySQL\u30B3\u30F3\u30C6\u30CA\u306F\u65E2\u306B\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059","success"),await U(n,e);return}c("MySQL\u30B3\u30F3\u30C6\u30CA\u3092\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info"),await p`docker start ${n}`.cwd(t).quiet(),await U(n,e)}async function tt(n,t,e){c("MySQL\u30B3\u30F3\u30C6\u30CA\u3092\u4F5C\u6210\u3057\u3066\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info");let s=process.env.MYSQL_ROOT_PASSWORD||"rootpassword",i=process.env.MYSQL_DATABASE||"portfolio",o=process.env.MYSQL_USER||"user",a=process.env.MYSQL_PASSWORD||"password";if(await p`docker run -d \
        --name ${n} \
        -p 3306:3306 \
        -e MYSQL_ROOT_PASSWORD=${s} \
        -e MYSQL_DATABASE=${i} \
        -e MYSQL_USER=${o} \
        -e MYSQL_PASSWORD=${a} \
        -v db-data:/var/lib/mysql \
        db`.cwd(t).quiet(),c("MySQL\u30B3\u30F3\u30C6\u30CA\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F","success"),!await U(n,e))c("MySQL\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F","warning")}async function et(n,t,e){if(await un(n)){c("Redis\u30B3\u30F3\u30C6\u30CA\u306F\u65E2\u306B\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059","success"),await V(n,e);return}c("Redis\u30B3\u30F3\u30C6\u30CA\u3092\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info"),await p`docker start ${n}`.cwd(t).quiet(),await V(n,e)}async function st(n,t,e){c("Redis\u30B3\u30F3\u30C6\u30CA\u3092\u4F5C\u6210\u3057\u3066\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info");let s=process.env.REDIS_PASSWORD||"password";if(await p`docker run -d \
        --name ${n} \
        -p 6379:6379 \
        -e REDIS_PASSWORD=${s} \
        -v cache-data:/data \
        cache`.cwd(t).quiet(),c("Redis\u30B3\u30F3\u30C6\u30CA\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F","success"),!await V(n,e))c("Redis\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F","warning")}async function it(n,t=!0){let s=O(n,".docker/db"),i=O(s,"Dockerfile");if(!F(i)){c("MySQL Dockerfile\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093","warning");return}try{if(!await cn()){c("Docker\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093","warning");return}if(await G("db"))c("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");else if(t)await Wn(n,i,s);else await Kn(n,i,s);if(await an("db")){await nt("db",n,t);return}await tt("db",n,t)}catch(o){if(c("MySQL\u30B3\u30F3\u30C6\u30CA\u306E\u8D77\u52D5\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),process.env.DEBUG)console.error(o)}}async function ot(n,t=!0){let s=O(n,".docker/cache"),i=O(s,"Dockerfile");if(!F(i)){c("Redis Dockerfile\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093","warning");return}try{if(!await cn()){c("Docker\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093","warning");return}if(await G("cache"))c("Redis Docker\u30A4\u30E1\u30FC\u30B8\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");else if(t)await Xn(n,i,s);else await Zn(n,i,s);if(await an("cache")){await et("cache",n,t);return}await st("cache",n,t)}catch(o){if(c("Redis\u30B3\u30F3\u30C6\u30CA\u306E\u8D77\u52D5\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),process.env.DEBUG)console.error(o)}}async function Y(n,t=!0){x("\uD83D\uDC33 Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9");let e=O(n,".docker/e2e/Dockerfile");if(F(e))try{if(await G("e2e"))c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");else if(t)await zn(n,e);else await Jn(n,e)}catch(s){if(c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),process.env.DEBUG)console.error(s)}await it(n,t),await ot(n,t)}w();w();var{$:rt}=globalThis.Bun;async function mn(n){x("\uD83D\uDCE6 \u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB");let t=new g("\u4F9D\u5B58\u95A2\u4FC2\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059");t.start();try{await rt`bun install --ignore-scripts`.cwd(n).quiet(),t.stop(!0,"\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(e){if(t.stop(!1,"\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),process.env.DEBUG)console.error(e);throw e}}w();var{$:P}=globalThis.Bun;import{existsSync as lt,readFileSync as ct,writeFileSync as hn}from"fs";import{join as H}from"path";var at=/Error:\s*([^\n]+)/,ut=/Duplicate key name/i,mt=[ut];async function ht(n){try{return(await P`docker ps --filter name=^${n}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===n}catch{return!1}}function ft(n){let t=n,e=t?.stderr?.toString()??t?.message??String(n);return at.exec(e)?.[1]?.trim()??null}function pt(n){return n.length>80?`${n.substring(0,77)}...`:n}function gt(n){let t=n,e=t?.stderr?.toString()??t?.stdout?.toString()??t?.message??String(n);return mt.some((s)=>s.test(e))}function fn(n,t){if(gt(n))t.stop(!0,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F\uFF08\u4E00\u90E8\u306E\u8B66\u544A\u3042\u308A\uFF09");else t.stop(!1,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u306B\u5931\u6557\u3057\u307E\u3057\u305F");if(process.env.DEBUG){console.error(n);return}let s=ft(n);if(s)c(pt(s),"warning")}function bt(){let n=process.env.MYSQL_USER||"user",t=process.env.MYSQL_PASSWORD||"password",e=process.env.MYSQL_DATABASE||"portfolio",s=process.env.MYSQL_HOST||"localhost",i=process.env.MYSQL_PORT||"3306";return`mysql://${n}:${t}@${s}:${i}/${e}`}async function dt(n){let t=new g("\u30ED\u30FC\u30AB\u30EBMySQL\u306B\u5BFE\u3057\u3066\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u3092\u5B9F\u884C\u3057\u3066\u3044\u307E\u3059");t.start();let e=H(n,"packages/db"),s=H(e,"prisma/schema/schema.prisma");if(!lt(s)){t.stop(!1,"\u30B9\u30AD\u30FC\u30DE\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");return}let i=bt(),o=ct(s,"utf-8"),a=o.replace(/provider\s*=\s*"sqlite"/,'provider = "mysql"');hn(s,a);try{await P`DATABASE_URL=${i} bun run push`.cwd(e).quiet(),t.stop(!0,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(u){fn(u,t)}finally{hn(s,o)}}async function xt(n){let t=new g("Cloudflare D1\u306B\u5BFE\u3057\u3066\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u3092\u5B9F\u884C\u3057\u3066\u3044\u307E\u3059");t.start();let e=H(n,"packages/db");try{await P`bun run migrate`.cwd(e).quiet(),t.stop(!0,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(s){fn(s,t)}}async function pn(n){if(x("\uD83D\uDD04 \u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3"),await ht("db"))await dt(n);else await xt(n)}w();var{$:gn}=globalThis.Bun;import{join as bn}from"path";var vt=/Error:\s*([^\n]+)/;async function Q(n,t=!0){if(x("\uD83D\uDDC4\uFE0F  Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210"),t){let e=new g("Prisma\u30B9\u30AD\u30FC\u30DE\u3092\u751F\u6210\u3057\u3066\u3044\u307E\u3059");e.start();try{await gn`bun run generate`.cwd(bn(n,"packages/db")).quiet(),e.stop(!0,"Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(s){e.stop(!1,"Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),dn(s)}}else{b("\uD83D\uDDC4\uFE0F","Prisma\u30B9\u30AD\u30FC\u30DE\u3092\u751F\u6210\u3057\u3066\u3044\u307E\u3059...","info");try{await gn`bun run generate`.cwd(bn(n,"packages/db")).quiet(),b("","Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(e){b("","Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),dn(e)}}}function dn(n){if(process.env.DEBUG){console.error(n);return}let t=n,e=t?.stderr?.toString()??t?.message??String(n),s=vt.exec(e);if(s?.[1]){let i=s[1].trim(),o=i.length>80?`${i.substring(0,77)}...`:i;c(o,"warning")}}function wt(n=process.cwd()){let t=W(n),e=W("/");while(t!==e){let s=wn(t,"package.json"),i=wn(t,"turbo.json");if(vn(s)&&vn(i))return t;t=W(t,"..")}return process.cwd()}async function yt(){if(process.versions?.bun!==void 0)return!0;try{if(xn!==void 0)return await xn`bun --version`.quiet(),!0}catch{return!1}return!1}function Ot(n){return!n.env&&!n.install&&!n.schema&&!n.docker&&!n.migrate}function St(n){let t=Ot(n);return{runEnv:t||n.env!==!1,runInstall:t||n.install!==!1,runSchema:t||n.schema!==!1,runDocker:t||n.docker!==!1,runMigrate:t||n.migrate!==!1,parallel:n.parallel??!0}}function Ct(){console.log(),console.log(m.default.bold(m.default.cyan("  \u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E"))),console.log(m.default.bold(m.default.cyan("  \u2502  \uD83D\uDE80 \u958B\u767A\u74B0\u5883\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3092\u958B\u59CB\u3057\u307E\u3059      \u2502"))),console.log(m.default.bold(m.default.cyan("  \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F")))}function Et(){console.log(),console.log(m.default.bold(m.default.green("  \u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E"))),console.log(m.default.bold(m.default.green("  \u2502  \u2705 \u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F\uFF01            \u2502"))),console.log(m.default.bold(m.default.green("  \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F"))),console.log(),console.log(m.default.bold("  \u6B21\u306E\u30B9\u30C6\u30C3\u30D7:")),console.log(m.default.dim("    \u2022 .env\u30D5\u30A1\u30A4\u30EB\u3092\u7DE8\u96C6\u3057\u3066\u74B0\u5883\u5909\u6570\u3092\u8A2D\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044")),console.log(m.default.dim("    \u2022 bun run dev \u3067\u958B\u767A\u30B5\u30FC\u30D0\u30FC\u3092\u8D77\u52D5\u3067\u304D\u307E\u3059")),console.log()}function kt(n){console.log(),console.error(m.default.bold(m.default.red("  \u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E"))),console.error(m.default.bold(m.default.red("  \u2502  \u2717 \u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F    \u2502"))),console.error(m.default.bold(m.default.red("  \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F"))),console.error(),console.error(m.default.red("  "),n),console.error()}async function $t(n,t){if(!t)return;if(process.env.BUN_LIFECYCLE_EVENT==="prepare"){let{logSection:s}=await Promise.resolve().then(() => (w(),ln));s("\uD83D\uDCE6 \u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB"),b("","\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3092\u30B9\u30AD\u30C3\u30D7\u3057\u307E\u3057\u305F\uFF08prepare\u30B9\u30AF\u30EA\u30D7\u30C8\u304B\u3089\u5B9F\u884C\u4E2D\uFF09","info");return}await mn(n)}async function At(n,t,e,s){let i=!s;if(s&&(t||e)){let o=[];if(t)o.push(Q(n,i));if(e)o.push(Y(n,i));await Promise.all(o);return}if(t)await Q(n,i);if(e)await Y(n,i)}async function K(n={}){let t=wt(),e=St(n);if(Ct(),!await yt())console.log(),console.error(m.default.red("  \u2717 Bun\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093\u3002")),console.error(m.default.dim("    Bun\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u304F\u3060\u3055\u3044: https://bun.sh")),process.exit(1);b("","Bun\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u3059","success");try{if(e.runEnv)await q(t);if(await $t(t,e.runInstall),await At(t,e.runSchema,e.runDocker,e.parallel),e.runMigrate)await pn(t);Et()}catch(i){kt(i),process.exit(1)}}var S=tn("workspace");S.command("setup","\u958B\u767A\u74B0\u5883\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3092\u5B9F\u884C\u3057\u307E\u3059").option("--env","\u74B0\u5883\u8A2D\u5B9A\u306E\u307F\u5B9F\u884C").option("--install","\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306E\u307F\u5B9F\u884C").option("--schema","Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u306E\u307F\u5B9F\u884C").option("--docker","Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306E\u307F\u5B9F\u884C").option("--migrate","\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u306E\u307F\u5B9F\u884C").option("--no-parallel","\u4E26\u5217\u5B9F\u884C\u3092\u7121\u52B9\u5316").action(async(n)=>{let t={env:n.env!==void 0,install:n.install!==void 0,schema:n.schema!==void 0,docker:n.docker!==void 0,migrate:n.migrate!==void 0,parallel:!n["no-parallel"]};await K(t)});S.command("*","\u958B\u767A\u74B0\u5883\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3092\u5B9F\u884C\u3057\u307E\u3059").action(async()=>{await K()});S.help();S.version("1.0.1");S.parse();
