#!/usr/bin/env bun
// @bun
var Ut=Object.create;var{getPrototypeOf:Vt,defineProperty:T,getOwnPropertyNames:Ft}=Object;var Gt=Object.prototype.hasOwnProperty;var P=(t,e,n)=>{n=t!=null?Ut(Vt(t)):{};let s=e||!t||!t.__esModule?T(n,"default",{value:t,enumerable:!0}):n;for(let o of Ft(t))if(!Gt.call(s,o))T(s,o,{get:()=>t[o],enumerable:!0});return s};var Qt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var tt=(t,e)=>{for(var n in e)T(t,n,{get:e[n],enumerable:!0,configurable:!0,set:(s)=>e[n]=()=>s})};var C=(t,e)=>()=>(t&&(e=t(t=0)),e);var A=Qt((mn,F)=>{var R=process||{},at=R.argv||[],M=R.env||{},Dt=!(!!M.NO_COLOR||at.includes("--no-color"))&&(!!M.FORCE_COLOR||at.includes("--color")||R.platform==="win32"||(R.stdout||{}).isTTY&&M.TERM!=="dumb"||!!M.CI),te=(t,e,n=t)=>(s)=>{let o=""+s,i=o.indexOf(e,t.length);return~i?t+ee(o,e,n,i)+e:t+o+e},ee=(t,e,n,s)=>{let o="",i=0;do o+=t.substring(i,s)+n,i=s+e.length,s=t.indexOf(e,i);while(~s);return o+t.substring(i)},ct=(t=Dt)=>{let e=t?te:()=>String;return{isColorSupported:t,reset:e("\x1B[0m","\x1B[0m"),bold:e("\x1B[1m","\x1B[22m","\x1B[22m\x1B[1m"),dim:e("\x1B[2m","\x1B[22m","\x1B[22m\x1B[2m"),italic:e("\x1B[3m","\x1B[23m"),underline:e("\x1B[4m","\x1B[24m"),inverse:e("\x1B[7m","\x1B[27m"),hidden:e("\x1B[8m","\x1B[28m"),strikethrough:e("\x1B[9m","\x1B[29m"),black:e("\x1B[30m","\x1B[39m"),red:e("\x1B[31m","\x1B[39m"),green:e("\x1B[32m","\x1B[39m"),yellow:e("\x1B[33m","\x1B[39m"),blue:e("\x1B[34m","\x1B[39m"),magenta:e("\x1B[35m","\x1B[39m"),cyan:e("\x1B[36m","\x1B[39m"),white:e("\x1B[37m","\x1B[39m"),gray:e("\x1B[90m","\x1B[39m"),bgBlack:e("\x1B[40m","\x1B[49m"),bgRed:e("\x1B[41m","\x1B[49m"),bgGreen:e("\x1B[42m","\x1B[49m"),bgYellow:e("\x1B[43m","\x1B[49m"),bgBlue:e("\x1B[44m","\x1B[49m"),bgMagenta:e("\x1B[45m","\x1B[49m"),bgCyan:e("\x1B[46m","\x1B[49m"),bgWhite:e("\x1B[47m","\x1B[49m"),blackBright:e("\x1B[90m","\x1B[39m"),redBright:e("\x1B[91m","\x1B[39m"),greenBright:e("\x1B[92m","\x1B[39m"),yellowBright:e("\x1B[93m","\x1B[39m"),blueBright:e("\x1B[94m","\x1B[39m"),magentaBright:e("\x1B[95m","\x1B[39m"),cyanBright:e("\x1B[96m","\x1B[39m"),whiteBright:e("\x1B[97m","\x1B[39m"),bgBlackBright:e("\x1B[100m","\x1B[49m"),bgRedBright:e("\x1B[101m","\x1B[49m"),bgGreenBright:e("\x1B[102m","\x1B[49m"),bgYellowBright:e("\x1B[103m","\x1B[49m"),bgBlueBright:e("\x1B[104m","\x1B[49m"),bgMagentaBright:e("\x1B[105m","\x1B[49m"),bgCyanBright:e("\x1B[106m","\x1B[49m"),bgWhiteBright:e("\x1B[107m","\x1B[49m")}};F.exports=ct();F.exports.createColors=ct});var pt={};tt(pt,{setupEnvFile:()=>G,logSubStep:()=>c,logStep:()=>u,logSection:()=>w,LoadingBar:()=>d});import{copyFileSync as ne,existsSync as ut,writeFileSync as se}from"fs";import{join as mt}from"path";function w(t){console.log(),console.log(x.default.bold(x.default.cyan(`  ${t}`))),console.log(x.default.dim(`  ${"\u2500".repeat(50)}`))}function u(t,e,n="info"){let s={info:x.default.blue,success:x.default.green,warning:x.default.yellow,error:x.default.red},o;if(n==="success")o="\u2713";else if(n==="error")o="\u2717";else if(n==="warning")o="\u26A0";else o="\u2192";console.log(`  ${s[n](o)} ${t} ${e}`)}function c(t,e="info"){let n={info:x.default.dim,success:x.default.green,warning:x.default.yellow},s;if(e==="success")s="\u2713";else if(e==="warning")s="\u26A0";else s="  ";console.log(`    ${n[e](s)} ${t}`)}class d{message;interval=null;frames=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"];frameIndex=0;isActive=!1;constructor(t){this.message=t}start(){if(this.isActive)return;this.isActive=!0,this.frameIndex=0,this.interval=setInterval(()=>{let t=this.frames[this.frameIndex%this.frames.length];process.stdout.write(`\r    ${x.default.cyan(t)} ${x.default.dim(this.message)}`),this.frameIndex++},100)}stop(t=!0,e){if(!this.isActive)return;if(this.isActive=!1,this.interval)clearInterval(this.interval),this.interval=null;if(process.stdout.write(`\r${" ".repeat(80)}\r`),e)c(e,t?"success":"warning")}}async function G(t){w("\uD83D\uDCDD \u74B0\u5883\u8A2D\u5B9A");let e=mt(t,".env.example"),n=mt(t,".env");if(ut(n)){u("",".env\u30D5\u30A1\u30A4\u30EB\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");return}if(ut(e))u("\uD83D\uDCDD",".env.example\u304B\u3089.env\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u3066\u3044\u307E\u3059...","info"),ne(e,n),u("",".env\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u307E\u3057\u305F","success");else u("\u26A0\uFE0F",".env.example\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002\u7A7A\u306E.env\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u307E\u3059...","warning"),se(n,`# Environment variables
`),u("","\u7A7A\u306E.env\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u307E\u3057\u305F","success")}var x;var y=C(()=>{x=P(A(),1)});var{$:g}=globalThis.Bun;import{existsSync as H}from"fs";import{join as O}from"path";async function ht(){try{return await g`docker --version`.quiet(),!0}catch{return!1}}async function ft(t){try{return(await g`docker ps -a --filter name=^${t}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===t}catch{return!1}}async function dt(t){try{return(await g`docker ps --filter name=^${t}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===t}catch{return!1}}async function z(t){try{return(await g`docker images --format {{.Repository}}:{{.Tag}}`.quiet()).stdout.toString().trim().split(`
`).some((s)=>s.startsWith(`${t}:`)||s===t)}catch{return!1}}async function oe(t,e,n){let s=new d("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059");s.start();try{await g`docker build -t db -f ${e} ${n}`.cwd(t).quiet(),s.stop(!0,"MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(o){throw s.stop(!1,"MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),o}}async function ie(t,e,n){c("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059...","info");try{await g`docker build -t db -f ${e} ${n}`.cwd(t).quiet(),c("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(s){throw c("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),s}}async function re(t,e){let n=new d("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059");n.start();try{await g`docker build -t e2e -f ${e} .`.cwd(t).quiet(),n.stop(!0,"E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(s){throw n.stop(!1,"E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),s}}async function le(t,e){c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059...","info");try{await g`docker build -t e2e -f ${e} .`.cwd(t).quiet(),c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(n){throw c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),n}}async function ae(t,e,n){let s=new d("Redis Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059");s.start();try{await g`docker build -t cache -f ${e} ${n}`.cwd(t).quiet(),s.stop(!0,"Redis Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(o){throw s.stop(!1,"Redis Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),o}}async function ce(t,e,n){c("Redis Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059...","info");try{await g`docker build -t cache -f ${e} ${n}`.cwd(t).quiet(),c("Redis Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(s){throw c("Redis Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),s}}async function ue(t,e){try{return(await g`docker exec -e MYSQL_PWD=${e} ${t} mysqladmin ping -h localhost -u root`.quiet()).exitCode===0}catch{return!1}}async function me(t,e){try{return(await g`docker exec ${t} redis-cli -a ${e} ping`.quiet()).stdout.toString().trim()==="PONG"}catch{return!1}}function k(t,e,n){if(t)t.stop(e,n);else c(n,e?"success":"warning")}async function pe(t,e,n){for(let s=0;s<n;s++){if(await ue(t,e))return!0;await new Promise((i)=>setTimeout(i,1000))}return!1}async function Q(t,e=!0,n=30){let s=process.env.MYSQL_ROOT_PASSWORD||"rootpassword",o=e?new d("MySQL\u306E\u8D77\u52D5\u3092\u5F85\u6A5F\u3057\u3066\u3044\u307E\u3059"):null;if(o)o.start();try{if(await pe(t,s,n))return k(o,!0,"MySQL\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F"),!0;return k(o,!1,"MySQL\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F"),!1}catch{return k(o,!1,"MySQL\u306E\u8D77\u52D5\u78BA\u8A8D\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),!1}}async function he(t,e,n){for(let s=0;s<n;s++){if(await me(t,e))return!0;await new Promise((i)=>setTimeout(i,1000))}return!1}async function Y(t,e=!0,n=30){let s=process.env.REDIS_PASSWORD||"password",o=e?new d("Redis\u306E\u8D77\u52D5\u3092\u5F85\u6A5F\u3057\u3066\u3044\u307E\u3059"):null;if(o)o.start();try{if(await he(t,s,n))return k(o,!0,"Redis\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F"),!0;return k(o,!1,"Redis\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F"),!1}catch{return k(o,!1,"Redis\u306E\u8D77\u52D5\u78BA\u8A8D\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),!1}}async function fe(t,e,n){if(await dt(t)){c("MySQL\u30B3\u30F3\u30C6\u30CA\u306F\u65E2\u306B\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059","success"),await Q(t,n);return}c("MySQL\u30B3\u30F3\u30C6\u30CA\u3092\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info"),await g`docker start ${t}`.cwd(e).quiet(),await Q(t,n)}async function de(t,e,n){c("MySQL\u30B3\u30F3\u30C6\u30CA\u3092\u4F5C\u6210\u3057\u3066\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info");let s=process.env.MYSQL_ROOT_PASSWORD||"rootpassword",o=process.env.MYSQL_DATABASE||"portfolio",i=process.env.MYSQL_USER||"user",l=process.env.MYSQL_PASSWORD||"password";if(await g`docker run -d \
        --name ${t} \
        -p 3306:3306 \
        -e MYSQL_ROOT_PASSWORD=${s} \
        -e MYSQL_DATABASE=${o} \
        -e MYSQL_USER=${i} \
        -e MYSQL_PASSWORD=${l} \
        -v db-data:/var/lib/mysql \
        db`.cwd(e).quiet(),c("MySQL\u30B3\u30F3\u30C6\u30CA\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F","success"),!await Q(t,n))c("MySQL\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F","warning")}async function ge(t,e,n){if(await dt(t)){c("Redis\u30B3\u30F3\u30C6\u30CA\u306F\u65E2\u306B\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059","success"),await Y(t,n);return}c("Redis\u30B3\u30F3\u30C6\u30CA\u3092\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info"),await g`docker start ${t}`.cwd(e).quiet(),await Y(t,n)}async function be(t,e,n){c("Redis\u30B3\u30F3\u30C6\u30CA\u3092\u4F5C\u6210\u3057\u3066\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info");let s=process.env.REDIS_PASSWORD||"password";if(await g`docker run -d \
        --name ${t} \
        -p 6379:6379 \
        -e REDIS_PASSWORD=${s} \
        -v cache-data:/data \
        cache`.cwd(e).quiet(),c("Redis\u30B3\u30F3\u30C6\u30CA\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F","success"),!await Y(t,n))c("Redis\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F","warning")}async function we(t,e=!0){let s=O(t,".docker/db"),o=O(s,"Dockerfile");if(!H(o)){c("MySQL Dockerfile\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093","warning");return}try{if(!await ht()){c("Docker\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093","warning");return}if(await z("db"))c("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");else if(e)await oe(t,o,s);else await ie(t,o,s);if(await ft("db")){await fe("db",t,e);return}await de("db",t,e)}catch(i){if(c("MySQL\u30B3\u30F3\u30C6\u30CA\u306E\u8D77\u52D5\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),process.env.DEBUG)console.error(i)}}async function xe(t,e=!0){let s=O(t,".docker/cache"),o=O(s,"Dockerfile");if(!H(o)){c("Redis Dockerfile\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093","warning");return}try{if(!await ht()){c("Docker\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093","warning");return}if(await z("cache"))c("Redis Docker\u30A4\u30E1\u30FC\u30B8\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");else if(e)await ae(t,o,s);else await ce(t,o,s);if(await ft("cache")){await ge("cache",t,e);return}await be("cache",t,e)}catch(i){if(c("Redis\u30B3\u30F3\u30C6\u30CA\u306E\u8D77\u52D5\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),process.env.DEBUG)console.error(i)}}async function W(t,e=!0){w("\uD83D\uDC33 Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9");let n=O(t,".docker/e2e/Dockerfile");if(H(n))try{if(await z("e2e"))c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");else if(e)await re(t,n);else await le(t,n)}catch(s){if(c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),process.env.DEBUG)console.error(s)}await we(t,e),await xe(t,e)}var gt=C(()=>{y()});var{$:ve}=globalThis.Bun;async function bt(t){w("\uD83D\uDCE6 \u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB");let e=new d("\u4F9D\u5B58\u95A2\u4FC2\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059");e.start();try{await ve`bun install --ignore-scripts`.cwd(t).quiet(),e.stop(!0,"\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(n){if(e.stop(!1,"\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),process.env.DEBUG)console.error(n);throw n}}var wt=C(()=>{y()});var{$:J}=globalThis.Bun;import{existsSync as ye,readFileSync as Se,writeFileSync as xt}from"fs";import{join as K}from"path";async function $e(t){try{return(await J`docker ps --filter name=^${t}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===t}catch{return!1}}function Ee(t){let e=t,n=e?.stderr?.toString()??e?.message??String(t);return Ce.exec(n)?.[1]?.trim()??null}function qe(t){return t.length>80?`${t.substring(0,77)}...`:t}function Me(t){let e=t,n=e?.stderr?.toString()??e?.stdout?.toString()??e?.message??String(t);return Oe.some((s)=>s.test(n))}function vt(t,e){if(Me(t))e.stop(!0,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F\uFF08\u4E00\u90E8\u306E\u8B66\u544A\u3042\u308A\uFF09");else e.stop(!1,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u306B\u5931\u6557\u3057\u307E\u3057\u305F");if(process.env.DEBUG){console.error(t);return}let s=Ee(t);if(s)c(qe(s),"warning")}function Re(){let t=process.env.MYSQL_USER||"user",e=process.env.MYSQL_PASSWORD||"password",n=process.env.MYSQL_DATABASE||"portfolio",s=process.env.MYSQL_HOST||"localhost",o=process.env.MYSQL_PORT||"3306";return`mysql://${t}:${e}@${s}:${o}/${n}`}async function Ae(t){let e=new d("\u30ED\u30FC\u30AB\u30EBMySQL\u306B\u5BFE\u3057\u3066\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u3092\u5B9F\u884C\u3057\u3066\u3044\u307E\u3059");e.start();let n=K(t,"packages/db"),s=K(n,"prisma/schema/schema.prisma");if(!ye(s)){e.stop(!1,"\u30B9\u30AD\u30FC\u30DE\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");return}let o=Re(),i=Se(s,"utf-8"),l=i.replace(/provider\s*=\s*"sqlite"/,'provider = "mysql"');xt(s,l);try{await J`DATABASE_URL=${o} bun run deploy`.cwd(n).quiet(),e.stop(!0,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(m){vt(m,e)}finally{xt(s,i)}}async function _e(t){let e=new d("Cloudflare D1\u306B\u5BFE\u3057\u3066\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u3092\u5B9F\u884C\u3057\u3066\u3044\u307E\u3059");e.start();let n=K(t,"packages/db");try{await J`bun run migrate`.cwd(n).quiet(),e.stop(!0,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(s){vt(s,e)}}async function yt(t){if(w("\uD83D\uDD04 \u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3"),await $e("db"))await Ae(t);else await _e(t)}var Ce,ke,Oe;var St=C(()=>{y();Ce=/Error:\s*([^\n]+)/,ke=/Duplicate key name/i,Oe=[ke]});var{$:Ct}=globalThis.Bun;import{join as kt}from"path";async function L(t,e=!0){if(w("\uD83D\uDDC4\uFE0F  Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210"),e){let n=new d("Prisma\u30B9\u30AD\u30FC\u30DE\u3092\u751F\u6210\u3057\u3066\u3044\u307E\u3059");n.start();try{await Ct`bun run generate`.cwd(kt(t,"packages/db")).quiet(),n.stop(!0,"Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(s){n.stop(!1,"Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),Ot(s)}}else{u("\uD83D\uDDC4\uFE0F","Prisma\u30B9\u30AD\u30FC\u30DE\u3092\u751F\u6210\u3057\u3066\u3044\u307E\u3059...","info");try{await Ct`bun run generate`.cwd(kt(t,"packages/db")).quiet(),u("","Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(n){u("","Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),Ot(n)}}}function Ot(t){if(process.env.DEBUG){console.error(t);return}let e=t,n=e?.stderr?.toString()??e?.message??String(t),s=Ie.exec(n);if(s?.[1]){let o=s[1].trim(),i=o.length>80?`${o.substring(0,77)}...`:o;c(i,"warning")}}var Ie;var $t=C(()=>{y();Ie=/Error:\s*([^\n]+)/});var Rt={};tt(Rt,{runWorkspace:()=>Z,findRootDir:()=>_});var{$:Et}=globalThis.Bun;import{existsSync as qt}from"fs";import{join as Mt,resolve as X}from"path";function _(t=process.cwd()){let e=X(t),n=X("/");while(e!==n){let s=Mt(e,"package.json"),o=Mt(e,"turbo.json");if(qt(s)&&qt(o))return e;e=X(e,"..")}return process.cwd()}async function Te(){if(process.versions?.bun!==void 0)return!0;try{if(Et!==void 0)return await Et`bun --version`.quiet(),!0}catch{return!1}return!1}function Pe(t){return!t.env&&!t.install&&!t.schema&&!t.docker&&!t.migrate}function je(t){let e=Pe(t);return{runEnv:e||t.env!==!1,runInstall:e||t.install!==!1,runSchema:e||t.schema!==!1,runDocker:e||t.docker!==!1,runMigrate:e||t.migrate!==!1,parallel:t.parallel??!0}}function Ue(){console.log(),console.log(p.default.bold(p.default.cyan("  \u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E"))),console.log(p.default.bold(p.default.cyan("  \u2502  \uD83D\uDE80 \u958B\u767A\u74B0\u5883\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3092\u958B\u59CB\u3057\u307E\u3059      \u2502"))),console.log(p.default.bold(p.default.cyan("  \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F")))}function Ve(){console.log(),console.log(p.default.bold(p.default.green("  \u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E"))),console.log(p.default.bold(p.default.green("  \u2502  \u2705 \u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F\uFF01            \u2502"))),console.log(p.default.bold(p.default.green("  \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F"))),console.log(),console.log(p.default.bold("  \u6B21\u306E\u30B9\u30C6\u30C3\u30D7:")),console.log(p.default.dim("    \u2022 .env\u30D5\u30A1\u30A4\u30EB\u3092\u7DE8\u96C6\u3057\u3066\u74B0\u5883\u5909\u6570\u3092\u8A2D\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044")),console.log(p.default.dim("    \u2022 bun run dev \u3067\u958B\u767A\u30B5\u30FC\u30D0\u30FC\u3092\u8D77\u52D5\u3067\u304D\u307E\u3059")),console.log()}function Fe(t){console.log(),console.error(p.default.bold(p.default.red("  \u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E"))),console.error(p.default.bold(p.default.red("  \u2502  \u2717 \u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F    \u2502"))),console.error(p.default.bold(p.default.red("  \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F"))),console.error(),console.error(p.default.red("  "),t),console.error()}async function Ge(t,e){if(!e)return;if(process.env.BUN_LIFECYCLE_EVENT==="prepare"){let{logSection:s}=await Promise.resolve().then(() => (y(),pt));s("\uD83D\uDCE6 \u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB"),u("","\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3092\u30B9\u30AD\u30C3\u30D7\u3057\u307E\u3057\u305F\uFF08prepare\u30B9\u30AF\u30EA\u30D7\u30C8\u304B\u3089\u5B9F\u884C\u4E2D\uFF09","info");return}await bt(t)}async function Qe(t,e,n,s){let o=!s;if(s&&(e||n)){let i=[];if(e)i.push(L(t,o));if(n)i.push(W(t,o));await Promise.all(i);return}if(e)await L(t,o);if(n)await W(t,o)}async function Z(t={}){let e=_(),n=je(t);if(Ue(),!await Te())console.log(),console.error(p.default.red("  \u2717 Bun\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093\u3002")),console.error(p.default.dim("    Bun\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u304F\u3060\u3055\u3044: https://bun.sh")),process.exit(1);u("","Bun\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u3059","success");try{if(n.runEnv)await G(e);if(await Ge(e,n.runInstall),await Qe(e,n.runSchema,n.runDocker,n.parallel),n.runMigrate)await yt(e);Ve()}catch(o){Fe(o),process.exit(1)}}var p;var N=C(()=>{p=P(A(),1);gt();y();wt();St();$t()});import{EventEmitter as Yt}from"events";function j(t){return t==null?[]:Array.isArray(t)?t:[t]}function Ht(t,e,n,s){var o,i=t[e],l=~s.string.indexOf(e)?n==null||n===!0?"":String(n):typeof n==="boolean"?n:~s.boolean.indexOf(e)?n==="false"?!1:n==="true"||(t._.push((o=+n,o*0===0)?o:n),!!n):(o=+n,o*0===0)?o:n;t[e]=i==null?l:Array.isArray(i)?i.concat(l):[i,l]}function zt(t,e){t=t||[],e=e||{};var n,s,o,i,l,m={_:[]},r=0,a=0,f=0,h=t.length;let v=e.alias!==void 0,I=e.unknown!==void 0,B=e.default!==void 0;if(e.alias=e.alias||{},e.string=j(e.string),e.boolean=j(e.boolean),v)for(n in e.alias){s=e.alias[n]=j(e.alias[n]);for(r=0;r<s.length;r++)(e.alias[s[r]]=s.concat(n)).splice(r,1)}for(r=e.boolean.length;r-- >0;){s=e.alias[e.boolean[r]]||[];for(a=s.length;a-- >0;)e.boolean.push(s[a])}for(r=e.string.length;r-- >0;){s=e.alias[e.string[r]]||[];for(a=s.length;a-- >0;)e.string.push(s[a])}if(B){for(n in e.default)if(i=typeof e.default[n],s=e.alias[n]=e.alias[n]||[],e[i]!==void 0){e[i].push(n);for(r=0;r<s.length;r++)e[i].push(s[r])}}let D=I?Object.keys(e.alias):[];for(r=0;r<h;r++){if(o=t[r],o==="--"){m._=m._.concat(t.slice(++r));break}for(a=0;a<o.length;a++)if(o.charCodeAt(a)!==45)break;if(a===0)m._.push(o);else if(o.substring(a,a+3)==="no-"){if(i=o.substring(a+3),I&&!~D.indexOf(i))return e.unknown(o);m[i]=!1}else{for(f=a+1;f<o.length;f++)if(o.charCodeAt(f)===61)break;i=o.substring(a,f),l=o.substring(++f)||(r+1===h||(""+t[r+1]).charCodeAt(0)===45||t[++r]),s=a===2?[i]:i;for(f=0;f<s.length;f++){if(i=s[f],I&&!~D.indexOf(i))return e.unknown("-".repeat(a)+i);Ht(m,i,f+1<s.length||l,e)}}}if(B){for(n in e.default)if(m[n]===void 0)m[n]=e.default[n]}if(v)for(n in m){s=e.alias[n]||[];while(s.length>0)m[s.shift()]=m[n]}return m}var st=(t)=>t.replace(/[<[].+/,"").trim(),Wt=(t)=>{let e=/<([^>]+)>/g,n=/\[([^\]]+)\]/g,s=[],o=(m)=>{let r=!1,a=m[1];if(a.startsWith("..."))a=a.slice(3),r=!0;return{required:m[0].startsWith("<"),value:a,variadic:r}},i;while(i=e.exec(t))s.push(o(i));let l;while(l=n.exec(t))s.push(o(l));return s},Kt=(t)=>{let e={alias:{},boolean:[]};for(let[n,s]of t.entries()){if(s.names.length>1)e.alias[s.names[0]]=s.names.slice(1);if(s.isBoolean)if(s.negated){if(!t.some((i,l)=>{return l!==n&&i.names.some((m)=>s.names.includes(m))&&typeof i.required==="boolean"}))e.boolean.push(s.names[0])}else e.boolean.push(s.names[0])}return e},et=(t)=>{return t.sort((e,n)=>{return e.length>n.length?-1:1})[0]},nt=(t,e)=>{return t.length>=e?t:`${t}${" ".repeat(e-t.length)}`},Jt=(t)=>{return t.replace(/([a-z])-([a-z])/g,(e,n,s)=>{return n+s.toUpperCase()})},Lt=(t,e,n)=>{let s=0,o=e.length,i=t,l;for(;s<o;++s)l=i[e[s]],i=i[e[s]]=s===o-1?n:l!=null?l:!!~e[s+1].indexOf(".")||!(+e[s+1]>-1)?{}:[]},Xt=(t,e)=>{for(let n of Object.keys(e)){let s=e[n];if(s.shouldTransform){if(t[n]=Array.prototype.concat.call([],t[n]),typeof s.transformFunction==="function")t[n]=t[n].map(s.transformFunction)}}},Zt=(t)=>{let e=/([^\\\/]+)$/.exec(t);return e?e[1]:""},ot=(t)=>{return t.split(".").map((e,n)=>{return n===0?Jt(e):e}).join(".")};class q extends Error{constructor(t){super(t);if(this.name=this.constructor.name,typeof Error.captureStackTrace==="function")Error.captureStackTrace(this,this.constructor);else this.stack=new Error(t).stack}}class it{constructor(t,e,n){if(this.rawName=t,this.description=e,this.config=Object.assign({},n),t=t.replace(/\.\*/g,""),this.negated=!1,this.names=st(t).split(",").map((s)=>{let o=s.trim().replace(/^-{1,2}/,"");if(o.startsWith("no-"))this.negated=!0,o=o.replace(/^no-/,"");return ot(o)}).sort((s,o)=>s.length>o.length?1:-1),this.name=this.names[this.names.length-1],this.negated&&this.config.default==null)this.config.default=!0;if(t.includes("<"))this.required=!0;else if(t.includes("["))this.required=!1;else this.isBoolean=!0}}var Nt=process.argv,Bt=`${process.platform}-${process.arch} node-${process.version}`;class U{constructor(t,e,n={},s){this.rawName=t,this.description=e,this.config=n,this.cli=s,this.options=[],this.aliasNames=[],this.name=st(t),this.args=Wt(t),this.examples=[]}usage(t){return this.usageText=t,this}allowUnknownOptions(){return this.config.allowUnknownOptions=!0,this}ignoreOptionDefaultValue(){return this.config.ignoreOptionDefaultValue=!0,this}version(t,e="-v, --version"){return this.versionNumber=t,this.option(e,"Display version number"),this}example(t){return this.examples.push(t),this}option(t,e,n){let s=new it(t,e,n);return this.options.push(s),this}alias(t){return this.aliasNames.push(t),this}action(t){return this.commandAction=t,this}isMatched(t){return this.name===t||this.aliasNames.includes(t)}get isDefaultCommand(){return this.name===""||this.aliasNames.includes("!")}get isGlobalCommand(){return this instanceof V}hasOption(t){return t=t.split(".")[0],this.options.find((e)=>{return e.names.includes(t)})}outputHelp(){let{name:t,commands:e}=this.cli,{versionNumber:n,options:s,helpCallback:o}=this.cli.globalCommand,i=[{body:`${t}${n?`/${n}`:""}`}];if(i.push({title:"Usage",body:`  $ ${t} ${this.usageText||this.rawName}`}),(this.isGlobalCommand||this.isDefaultCommand)&&e.length>0){let r=et(e.map((a)=>a.rawName));i.push({title:"Commands",body:e.map((a)=>{return`  ${nt(a.rawName,r.length)}  ${a.description}`}).join(`
`)}),i.push({title:"For more info, run any command with the `--help` flag",body:e.map((a)=>`  $ ${t}${a.name===""?"":` ${a.name}`} --help`).join(`
`)})}let m=this.isGlobalCommand?s:[...this.options,...s||[]];if(!this.isGlobalCommand&&!this.isDefaultCommand)m=m.filter((r)=>r.name!=="version");if(m.length>0){let r=et(m.map((a)=>a.rawName));i.push({title:"Options",body:m.map((a)=>{return`  ${nt(a.rawName,r.length)}  ${a.description} ${a.config.default===void 0?"":`(default: ${a.config.default})`}`}).join(`
`)})}if(this.examples.length>0)i.push({title:"Examples",body:this.examples.map((r)=>{if(typeof r==="function")return r(t);return r}).join(`
`)});if(o)i=o(i)||i;console.log(i.map((r)=>{return r.title?`${r.title}:
${r.body}`:r.body}).join(`

`))}outputVersion(){let{name:t}=this.cli,{versionNumber:e}=this.cli.globalCommand;if(e)console.log(`${t}/${e} ${Bt}`)}checkRequiredArgs(){let t=this.args.filter((e)=>e.required).length;if(this.cli.args.length<t)throw new q(`missing required args for command \`${this.rawName}\``)}checkUnknownOptions(){let{options:t,globalCommand:e}=this.cli;if(!this.config.allowUnknownOptions){for(let n of Object.keys(t))if(n!=="--"&&!this.hasOption(n)&&!e.hasOption(n))throw new q(`Unknown option \`${n.length>1?`--${n}`:`-${n}`}\``)}}checkOptionValue(){let{options:t,globalCommand:e}=this.cli,n=[...e.options,...this.options];for(let s of n){let o=t[s.name.split(".")[0]];if(s.required){let i=n.some((l)=>l.negated&&l.names.includes(s.name));if(o===!0||o===!1&&!i)throw new q(`option \`${s.rawName}\` value is missing`)}}}}class V extends U{constructor(t){super("@@global@@","",{},t)}}var E=Object.assign;class rt extends Yt{constructor(t=""){super();this.name=t,this.commands=[],this.rawArgs=[],this.args=[],this.options={},this.globalCommand=new V(this),this.globalCommand.usage("<command> [options]")}usage(t){return this.globalCommand.usage(t),this}command(t,e,n){let s=new U(t,e||"",n,this);return s.globalCommand=this.globalCommand,this.commands.push(s),s}option(t,e,n){return this.globalCommand.option(t,e,n),this}help(t){return this.globalCommand.option("-h, --help","Display this message"),this.globalCommand.helpCallback=t,this.showHelpOnExit=!0,this}version(t,e="-v, --version"){return this.globalCommand.version(t,e),this.showVersionOnExit=!0,this}example(t){return this.globalCommand.example(t),this}outputHelp(){if(this.matchedCommand)this.matchedCommand.outputHelp();else this.globalCommand.outputHelp()}outputVersion(){this.globalCommand.outputVersion()}setParsedInfo({args:t,options:e},n,s){if(this.args=t,this.options=e,n)this.matchedCommand=n;if(s)this.matchedCommandName=s;return this}unsetMatchedCommand(){this.matchedCommand=void 0,this.matchedCommandName=void 0}parse(t=Nt,{run:e=!0}={}){if(this.rawArgs=t,!this.name)this.name=t[1]?Zt(t[1]):"cli";let n=!0;for(let o of this.commands){let i=this.mri(t.slice(2),o),l=i.args[0];if(o.isMatched(l)){n=!1;let m=E(E({},i),{args:i.args.slice(1)});this.setParsedInfo(m,o,l),this.emit(`command:${l}`,o)}}if(n){for(let o of this.commands)if(o.name===""){n=!1;let i=this.mri(t.slice(2),o);this.setParsedInfo(i,o),this.emit("command:!",o)}}if(n){let o=this.mri(t.slice(2));this.setParsedInfo(o)}if(this.options.help&&this.showHelpOnExit)this.outputHelp(),e=!1,this.unsetMatchedCommand();if(this.options.version&&this.showVersionOnExit&&this.matchedCommandName==null)this.outputVersion(),e=!1,this.unsetMatchedCommand();let s={args:this.args,options:this.options};if(e)this.runMatchedCommand();if(!this.matchedCommand&&this.args[0])this.emit("command:*");return s}mri(t,e){let n=[...this.globalCommand.options,...e?e.options:[]],s=Kt(n),o=[],i=t.indexOf("--");if(i>-1)o=t.slice(i+1),t=t.slice(0,i);let l=zt(t,s);l=Object.keys(l).reduce((h,v)=>{return E(E({},h),{[ot(v)]:l[v]})},{_:[]});let m=l._,r={"--":o},a=e&&e.config.ignoreOptionDefaultValue?e.config.ignoreOptionDefaultValue:this.globalCommand.config.ignoreOptionDefaultValue,f=Object.create(null);for(let h of n){if(!a&&h.config.default!==void 0)for(let v of h.names)r[v]=h.config.default;if(Array.isArray(h.config.type)){if(f[h.name]===void 0)f[h.name]=Object.create(null),f[h.name].shouldTransform=!0,f[h.name].transformFunction=h.config.type[0]}}for(let h of Object.keys(l))if(h!=="_"){let v=h.split(".");Lt(r,v,l[h]),Xt(r,f)}return{args:m,options:r}}runMatchedCommand(){let{args:t,options:e,matchedCommand:n}=this;if(!n||!n.commandAction)return;n.checkUnknownOptions(),n.checkOptionValue(),n.checkRequiredArgs();let s=[];return n.args.forEach((o,i)=>{if(o.variadic)s.push(t.slice(i));else s.push(t[i])}),s.push(e),n.commandAction.apply(this,s)}}var lt=(t="")=>new rt(t);N();y();var{$:Ye,spawn:He}=globalThis.Bun;import{existsSync as ze,readdirSync as We,readFileSync as Ke}from"fs";import{join as At}from"path";var Je=/Error:\s*([^\n]+)/;async function Le(t){try{return(await Ye`docker ps --filter name=^${t}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===t}catch{return!1}}function Xe(t){let e=t,n=e?.stderr?.toString()??e?.message??String(t);return Je.exec(n)?.[1]?.trim()??null}function Ze(t){return t.length>80?`${t.substring(0,77)}...`:t}function Ne(t,e){if(e.stop(!1,"\u30B7\u30FC\u30C9\u30C7\u30FC\u30BF\u306E\u6295\u5165\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),process.env.DEBUG){console.error(t);return}let n=Xe(t);if(n)c(Ze(n),"warning")}async function Be(t){let e=new d("\u30ED\u30FC\u30AB\u30EBMySQL\u306B\u30B7\u30FC\u30C9\u30C7\u30FC\u30BF\u3092\u6295\u5165\u3057\u3066\u3044\u307E\u3059");e.start();let n=At(t,".docker/db/seed");if(!ze(n)){e.stop(!1,"\u30B7\u30FC\u30C9\u30C7\u30A3\u30EC\u30AF\u30C8\u30EA\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");return}let s=We(n).filter((r)=>r.endsWith(".sql")).sort((r,a)=>r.localeCompare(a)).map((r)=>At(n,r));if(s.length===0){e.stop(!1,"\u30B7\u30FC\u30C9\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");return}let o=process.env.MYSQL_USER||"user",i=process.env.MYSQL_PASSWORD||"password",l=process.env.MYSQL_DATABASE||"portfolio",m="db";try{for(let r of s){let a=r.split("/").pop()||r;c(`\u5B9F\u884C\u4E2D: ${a}`,"info");let f=Ke(r,"utf-8"),h=He(["docker","exec","-i",m,"mysql","-u",o,`-p${i}`,l],{stdin:"pipe",stdout:"pipe",stderr:"pipe"});if(h.stdin.write(f),h.stdin.end(),await h.exited,h.exitCode!==0){let v=await h.stderr.text();throw new Error(`Failed to execute seed file ${a}: ${v}`)}}e.stop(!0,"\u30B7\u30FC\u30C9\u30C7\u30FC\u30BF\u306E\u6295\u5165\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(r){throw Ne(r,e),r}}async function _t(t){if(w("\uD83C\uDF31 \u30B7\u30FC\u30C9\u30C7\u30FC\u30BF\u306E\u6295\u5165"),!await Le("db")){c("MySQL\u30B3\u30F3\u30C6\u30CA\u304C\u8D77\u52D5\u3057\u3066\u3044\u307E\u305B\u3093","warning"),c("\u30B3\u30F3\u30C6\u30CA\u3092\u8D77\u52D5\u3057\u3066\u304B\u3089\u518D\u5EA6\u5B9F\u884C\u3057\u3066\u304F\u3060\u3055\u3044","info");return}await Be(t)}var $=P(A(),1);y();var{$:b}=globalThis.Bun;import{createInterface as De}from"readline";async function It(t){try{return await b`${t} --version`.quiet(),!0}catch{return!1}}async function tn(t){let e=De({input:process.stdin,output:process.stdout});return new Promise((n)=>{e.question(t,(s)=>{e.close();let o=s.trim().toLowerCase();n(o==="y"||o==="yes"||o==="\u306F\u3044")})})}async function en(){u("","nvm\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059...","info");try{await b`curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash`.quiet(),u("","nvm\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success"),u("","\u30B7\u30A7\u30EB\u3092\u518D\u8D77\u52D5\u3059\u308B\u304B\u3001\u4EE5\u4E0B\u306E\u30B3\u30DE\u30F3\u30C9\u3092\u5B9F\u884C\u3057\u3066\u304F\u3060\u3055\u3044:","info"),console.log($.default.dim(String.raw`    export NVM_DIR="$HOME/.nvm"`)),console.log($.default.dim(String.raw`    [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"`)),console.log($.default.dim("    nvm install --lts")),console.log(),console.log($.default.yellow("  \u6CE8\u610F: node\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u306F\u30B7\u30A7\u30EB\u306E\u518D\u8D77\u52D5\u304C\u5FC5\u8981\u3067\u3059\u3002"))}catch(t){throw u("","nvm\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F","error"),t}}async function nn(){u("","Docker\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059...","info");try{await b`curl -fsSL https://get.docker.com/ | sh`.quiet(),u("","Docker\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(t){throw u("","Docker\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F","error"),t}}async function sn(){u("","Doppler CLI\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059...","info");try{let e=(await b`uname -m`.quiet()).stdout.toString().trim()==="arm64"?"arm64":"amd64";await b`curl -Ls --tlsv1.2 --proto "=https" -o /tmp/doppler.tar.gz https://cli.doppler.com/download/darwin/${e}`.quiet(),await b`tar -xzf /tmp/doppler.tar.gz -C /tmp`.quiet(),await b`sudo mv /tmp/doppler /usr/local/bin/doppler`.quiet(),await b`rm /tmp/doppler.tar.gz`.quiet(),u("","Doppler CLI\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(t){throw u("","Doppler CLI\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F","error"),t}}async function on(){u("","Codex CLI\u3092GitHub\u30EA\u30EA\u30FC\u30B9\u304B\u3089\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059...","info");try{let t=await fetch("https://api.github.com/repos/openai/codex/releases/latest");if(!t.ok)throw new Error(`GitHub API\u30A8\u30E9\u30FC: ${t.status}`);let e=await t.json(),o=`codex-${(await b`uname -m`.quiet()).stdout.toString().trim()==="arm64"?"aarch64":"x86_64"}-apple-darwin.tar.gz`,i=e.assets.find((m)=>m.name===o);if(!i)throw new Error(`\u30A2\u30BB\u30C3\u30C8\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093: ${o}`);u("",`\u30D0\u30FC\u30B8\u30E7\u30F3 ${e.tag_name} \u3092\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9\u3057\u3066\u3044\u307E\u3059...`,"info");let l=`/tmp/${o}`;await b`curl -fsSL -o ${l} ${i.browser_download_url}`.quiet(),await b`tar -xzf ${l} -C /tmp`.quiet(),await b`sudo mv /tmp/codex /usr/local/bin/codex`.quiet(),await b`sudo chmod +x /usr/local/bin/codex`.quiet(),await b`rm ${l}`.quiet(),u("",`Codex CLI ${e.tag_name} \u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F`,"success")}catch(t){if(u("","Codex CLI\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F","error"),t instanceof Error)u("",t.message,"error");throw t}}async function rn(t){if(typeof t.installScript==="string"){u("",`${t.name}\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059...`,"info");try{await b`${t.installScript}`.quiet(),u("",`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F`,"success")}catch(e){throw u("",`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F`,"error"),e}}else await t.installScript()}var Tt=[{name:"node",checkCommand:"node",installScript:en,description:"Node.js (nvm\u7D4C\u7531)",required:!0},{name:"bun",checkCommand:"bun",installScript:"curl -fsSL https://bun.sh/install | bash",description:"Bun",required:!0},{name:"docker",checkCommand:"docker",installScript:nn,description:"Docker",required:!0},{name:"pulumi",checkCommand:"pulumi",installScript:"curl -fsSL https://get.pulumi.com | sh",description:"Pulumi",required:!0},{name:"doppler",checkCommand:"doppler",installScript:sn,description:"Doppler CLI",required:!0},{name:"coderabbit",checkCommand:"coderabbit",installScript:"curl -fsSL https://cli.coderabbit.ai/install.sh | sh",description:"CodeRabbit CLI",required:!1},{name:"claude",checkCommand:"claude",installScript:"curl -fsSL https://claude.ai/install.sh | bash",description:"Claude Code",required:!1},{name:"codex",checkCommand:"codex",installScript:on,description:"Codex CLI",required:!1}];async function ln(t,e){if(await It(t.checkCommand)){u("",`${t.name}\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u3059`,"success");return}let s=e?"\uFF08\u30AA\u30D7\u30B7\u30E7\u30F3\uFF09":"",o=`${t.name}\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093${s}\u3002\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u307E\u3059\u304B\uFF1F (y/n): `;if(!await tn(o)){let l=e?"info":"warning";u("",`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3092\u30B9\u30AD\u30C3\u30D7\u3057\u307E\u3057\u305F`,l);return}try{if(await rn(t),await It(t.checkCommand))u("",`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u78BA\u8A8D\u3055\u308C\u307E\u3057\u305F`,"success");else u("",`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u5F8C\u3001\u30B3\u30DE\u30F3\u30C9\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002\u30B7\u30A7\u30EB\u3092\u518D\u8D77\u52D5\u3057\u3066\u304F\u3060\u3055\u3044`,"warning")}catch(l){if(u("",`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F`,"error"),process.env.DEBUG)console.error(l)}}async function Pt(t,e){if(e&&t.length>0)console.log(),u("","\u30AA\u30D7\u30B7\u30E7\u30F3\u30B3\u30DE\u30F3\u30C9\u306E\u78BA\u8A8D","info");for(let n of t)await ln(n,e)}async function jt(){w("\uD83D\uDD0D \u30B3\u30DE\u30F3\u30C9\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u78BA\u8A8D");let t=Tt.filter((n)=>n.required),e=Tt.filter((n)=>!n.required);await Pt(t,!1),await Pt(e,!0),console.log(),u("","\u30B3\u30DE\u30F3\u30C9\u306E\u78BA\u8A8D\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}var S=lt("workspace");S.command("setup","\u958B\u767A\u74B0\u5883\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3092\u5B9F\u884C\u3057\u307E\u3059").option("--env","\u74B0\u5883\u8A2D\u5B9A\u306E\u307F\u5B9F\u884C").option("--install","\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306E\u307F\u5B9F\u884C").option("--schema","Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u306E\u307F\u5B9F\u884C").option("--docker","Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306E\u307F\u5B9F\u884C").option("--migrate","\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u306E\u307F\u5B9F\u884C").option("--no-parallel","\u4E26\u5217\u5B9F\u884C\u3092\u7121\u52B9\u5316").action(async(t)=>{let e={env:t.env!==void 0,install:t.install!==void 0,schema:t.schema!==void 0,docker:t.docker!==void 0,migrate:t.migrate!==void 0,parallel:!t["no-parallel"]};await Z(e)});S.command("seed","\u30B7\u30FC\u30C9\u30C7\u30FC\u30BF\u3092\u6295\u5165\u3057\u307E\u3059").action(async()=>{let t=_();await _t(t)});S.command("check","\u5FC5\u8981\u306A\u30B3\u30DE\u30F3\u30C9\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u78BA\u8A8D\u3068\u5BFE\u8A71\u7684\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3092\u5B9F\u884C\u3057\u307E\u3059").action(async()=>{await jt()});S.command("*","\u958B\u767A\u74B0\u5883\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3092\u5B9F\u884C\u3057\u307E\u3059").action(async()=>{let{runWorkspace:t}=await Promise.resolve().then(() => (N(),Rt));await t()});S.help();S.version("1.0.1");S.parse();
